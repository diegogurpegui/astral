"use strict";(globalThis["webpackChunkastral"]=globalThis["webpackChunkastral"]||[]).push([[636],{57636:(e,s,t)=>{t.r(s),t.d(s,{default:()=>Z});var a=t(59835),i=t(86970),r=t(61957);const l={key:0,class:"flex row justify-center items-start q-my-md"},o={class:"col q-pl-md q-pr-auto flex row"},n={class:"no-padding text-right"},c={key:0,class:"m-8 text-base"},u=(0,a.Uk)(" Start a chat by clicking "),h=(0,a.Uk)(" icon on someone's profile page or user card. ");function p(e,s,t,p,d,m){const k=(0,a.up)("BaseHeader"),g=(0,a.up)("q-spinner-orbit"),b=(0,a.up)("BaseUserCard"),w=(0,a.up)("q-badge"),y=(0,a.up)("q-item"),f=(0,a.up)("q-list"),q=(0,a.up)("q-icon"),v=(0,a.up)("q-page"),C=(0,a.Q2)("ripple");return(0,a.wg)(),(0,a.j4)(v,null,{default:(0,a.w5)((()=>[(0,a.Wm)(k,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.$t("inbox")),1)])),_:1}),(0,a.Wm)(f,{class:"q-py-sm q-pr-sm q-gutter-sm"},{default:(0,a.w5)((()=>[d.loading?((0,a.wg)(),(0,a.iD)("div",l,[(0,a.Wm)(g,{color:"accent",size:"md"})])):(0,a.kq)("",!0),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(d.chats,(s=>(0,a.wy)(((0,a.wg)(),(0,a.j4)(y,{key:s.peer,clickable:"",class:"flex row no-padding no-margin justify-between items-center q-gutter-xs",onClickCapture:(0,r.iM)((t=>e.$router.push({name:"messages",params:{pubkey:s.peer}})),["stop"])},{default:(0,a.w5)((()=>[(0,a._)("div",o,[s.peer?((0,a.wg)(),(0,a.j4)(b,{key:0,pubkey:s.peer,"action-buttons":!1,class:"col",clickable:!1,"show-following":!0},null,8,["pubkey"])):(0,a.kq)("",!0),e.$store.state.unreadMessages[s.peer]?((0,a.wg)(),(0,a.j4)(w,{key:1,color:"secondary",outline:"",class:"text-bold q-my-auto"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.$store.state.unreadMessages[s.peer]),1)])),_:2},1024)):(0,a.kq)("",!0)]),(0,a._)("label",n,(0,i.zw)(e.niceDateUTC(s.lastMessage)),1)])),_:2},1032,["onClickCapture"])),[[C]]))),128))])),_:1}),d.noChats?((0,a.wg)(),(0,a.iD)("div",c,[(0,a._)("p",null,[u,(0,a.Wm)(q,{unelevated:"",color:"primary",name:"mail_lock",size:"md"}),h])])):(0,a.kq)("",!0)])),_:1})}t(40702);var d=t(34136),m=t(18933);const k={name:"Inbox",mixins:[m.Z],data(){return{chats:[],loading:!0,noChats:!1,profilesUsed:new Set,sub:null}},computed:{allChatsNeverRead(){return 0===Object.keys(this.$store.state.lastMessageRead).length}},async activated(){this.chats=await(0,d.mw)(this.$store.state.keys.pub),0===this.chats.length&&(this.noChats=!0),this.chats.forEach((({peer:e})=>this.useProfile(e))),this.allChatsNeverRead&&this.chats.forEach((({peer:e})=>this.$store.commit("haveReadMessage",e))),this.loading=!1,this.sub=await(0,d.yt)((async e=>{e.pubkey!==this.$store.state.keys.pub&&(this.chats=await(0,d.mw)(this.$store.state.keys.pub),this.useProfile(e.pubkey))}))},deactivated(){this.sub&&(this.sub.cancel(),this.sub=null),this.profilesUsed.forEach((e=>this.$store.dispatch("cancelUseProfile",{pubkey:e})))},methods:{markAllAsRead(){this.chats.forEach((e=>{this.$store.commit("haveReadMessage",e.peer)}))},useProfile(e){this.profilesUsed.has(e)||(this.profilesUsed.add(e),this.$store.dispatch("useProfile",{pubkey:e}))}}};var g=t(11639),b=t(69885),w=t(13246),y=t(10786),f=t(490),q=t(20990),v=t(22857),C=t(51136),$=t(69984),U=t.n($);const x=(0,g.Z)(k,[["render",p]]),Z=x;U()(k,"components",{QPage:b.Z,QList:w.Z,QSpinnerOrbit:y.Z,QItem:f.Z,QBadge:q.Z,QIcon:v.Z}),U()(k,"directives",{Ripple:C.Z})}}]);