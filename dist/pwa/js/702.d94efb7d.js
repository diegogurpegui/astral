"use strict";(globalThis["webpackChunkastral"]=globalThis["webpackChunkastral"]||[]).push([[702],{84777:(e,t,s)=>{s.r(t),s.d(t,{default:()=>m});var a=s(59835),o=s(86970);function l(e,t,s,l,i,n){const d=(0,a.up)("BaseHeader"),r=(0,a.up)("q-tab"),h=(0,a.up)("q-tabs"),b=(0,a.up)("BaseButtonLoadMore"),u=(0,a.up)("BasePostThread"),c=(0,a.up)("q-page");return(0,a.wg)(),(0,a.j4)(c,null,{default:(0,a.w5)((()=>[(0,a._)("div",null,[(0,a.Wm)(d,{separator:!1},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.$t("feed")),1)])),_:1}),(0,a.Wm)(h,{modelValue:e.tab,"onUpdate:modelValue":t[0]||(t[0]=t=>e.tab=t),dense:"",outline:"",align:"left","active-color":"accent",breakpoint:0},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{name:"follows",label:"follows"}),(0,a.Wm)(r,{name:"global",label:"global"}),(0,a.Wm)(r,{name:"bots",label:"bots"})])),_:1},8,["modelValue"])]),e.unreadFeed[e.tab].length?((0,a.wg)(),(0,a.j4)(b,{key:0,"loading-more":e.loadingUnread,label:"load "+e.unreadFeed[e.tab].length+" unread",onClick:e.loadUnread},null,8,["loading-more","label","onClick"])):(0,a.kq)("",!0),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.feed[e.tab],((t,s)=>((0,a.wg)(),(0,a.j4)(u,{key:s,events:t,class:"full-width",onAddEvent:e.processEvent},null,8,["events","onAddEvent"])))),128)),(0,a.Wm)(b,{"loading-more":e.loadingMore,label:"load another day",onClick:e.loadMore},null,8,["loading-more","onClick"])])),_:1})}s(40702),s(46727);var i=s(18933),n=s(14473),d=s(22330),r=s(34136),h=s(80626);const b=(0,a.aZ)({name:"Feed",mixins:[i.Z],components:{BaseButtonLoadMore:h.Z},data(){return{listener:null,reachedEnd:!1,feed:{follows:[],global:[],bots:[]},unreadFeed:{follows:[],global:[],bots:[]},feedSet:new Set,bots:[],follows:[],botTracker:"29f63b70d8961835b14062b195fc7d84fa810560b36dde0749e4bc084f0f8952",loadingMore:!0,loadingUnread:!1,tab:"follows",sub:null,since:Math.round(Date.now()/1e3)-86400,profilesUsed:new Set,active:!1}},computed:{items(){return"follows"===this.tab?this.feed.follows:"global"===this.tab?this.feed.global:"bots"===this.tab?this.feed.bots:[]}},async mounted(){this.bots=await this.getFollows(this.botTracker),this.follows=await this.getFollows(this.$store.state.keys.pub),this.loadMore(),0===this.follows.length&&(this.tab="global")},activated(){this.active=!0},async beforeUnmount(){this.listener&&this.listener.cancel(),this.sub&&this.sub.cancel(),this.sub=null,this.profilesUsed.forEach((e=>this.$store.dispatch("cancelUseProfile",{pubkey:e})))},deactivated(){this.active=!1},methods:{async loadMore(){this.loadingMore=!0;let e={};for(let s of Object.keys(this.feed))e[s]=[];this.sub?(this.since=this.since-86400,this.sub.update(this.since-86400)):this.sub=await(0,r.oQ)(this.since-86400,(e=>{this.processEvent(e,this.unreadFeed)}));let t=await(0,r.Zd)(this.since);if(t)for(let s of t)this.processEvent(s,e);for(let s of Object.keys(this.feed))this.feed[s]=this.feed[s].concat(e[s]);this.loadingMore=!1},loadUnread(){this.loadingUnread=!0,this.feed[this.tab]=this.unreadFeed[this.tab].concat(this.feed[this.tab]),this.unreadFeed[this.tab]=[],this.loadingUnread=!1},processEvent(e,t=this.feed){(0,d.nf)(e)&&(this.feedSet.has(e.id)||e.created_at<this.since||(this.feedSet.add(e.id),this.interpolateEventMentions(e),this.useProfile(e.pubkey),this.follows.includes(e.pubkey)&&(0,n.c)(t.follows,Object.assign({},e),"feed",e.pubkey!==this.$store.state.keys.pub),this.isBot(e)?(0,n.c)(t.bots,Object.assign({},e),"feed",e.pubkey!==this.$store.state.keys.pub):(0,n.c)(t.global,Object.assign({},e),"feed",e.pubkey!==this.$store.state.keys.pub)))},async getFollows(e){let t=await(0,r.MD)(e);return t?t.tags.filter((([e,t])=>"p"===e&&t)).map((([e,t])=>t)):[]},useProfile(e){this.profilesUsed.has(e)||(this.profilesUsed.add(e),this.$store.dispatch("useProfile",{pubkey:e}))},isBot(e){return!!this.bots.includes(e.pubkey)||!!e.content.includes("https://www.minds.com/newsfeed/")}}});var u=s(11639),c=s(69885),f=s(47817),p=s(70900),g=s(69984),w=s.n(g);const k=(0,u.Z)(b,[["render",l],["__scopeId","data-v-4e64760a"]]),m=k;w()(b,"components",{QPage:c.Z,QTabs:f.Z,QTab:p.Z})}}]);