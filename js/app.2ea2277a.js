(()=>{var e={94188:(e,t,n)=>{"use strict";n(40702),n(18964);var s=n(61957),o=n(71947),i=n(60499),a=n(59835);function r(e,t,n,s,o,i){const r=(0,a.up)("router-view");return(0,a.wg)(),(0,a.j4)(r)}const l=(0,a.aZ)({name:"App"});var d=n(11639);const u=(0,d.Z)(l,[["render",r]]),c=u;var p=n(6549),h=n(81081),y=n(28339);const f=[{path:"/",component:()=>Promise.all([n.e(736),n.e(64),n.e(6)]).then(n.bind(n,18534)),children:[{path:"",component:()=>Promise.all([n.e(736),n.e(64),n.e(722)]).then(n.bind(n,39722))},{path:"/feed",component:()=>Promise.all([n.e(736),n.e(64),n.e(702)]).then(n.bind(n,84777)),name:"feed"},{path:"/follow",component:()=>Promise.all([n.e(736),n.e(64),n.e(183)]).then(n.bind(n,33587)),name:"follow"},{path:"/settings",component:()=>Promise.all([n.e(736),n.e(196)]).then(n.bind(n,66196)),name:"settings"},{path:"/messages/inbox",component:()=>Promise.all([n.e(736),n.e(636)]).then(n.bind(n,57636)),name:"inbox"},{path:"/messages/:pubkey([a-f0-9A-F]{64})",component:()=>Promise.all([n.e(736),n.e(198)]).then(n.bind(n,73198)),name:"messages"},{path:"/event/:eventId([a-f0-9A-F]{64})",component:()=>Promise.all([n.e(736),n.e(64),n.e(355)]).then(n.bind(n,77355)),name:"event"},{path:"/notifications",component:()=>Promise.all([n.e(736),n.e(433)]).then(n.bind(n,15433)),name:"notifications"},{path:"/:pubkey([a-f0-9A-F]{64})",component:()=>Promise.all([n.e(736),n.e(64),n.e(584)]).then(n.bind(n,61770)),name:"profile"},{path:"/hashtag/:hashtagId([a-zA-Z0-9_]{1,63})",component:()=>Promise.all([n.e(736),n.e(64),n.e(316)]).then(n.bind(n,49316)),name:"hashtag"},{path:"/devTools",component:()=>Promise.all([n.e(736),n.e(369)]).then(n.bind(n,55369)),name:"devTools"},{path:"/:catchAll(.*)*",component:()=>Promise.all([n.e(736),n.e(64),n.e(437)]).then(n.bind(n,86437))}]}],m=f,g=(0,h.BC)((()=>{const e=y.PO,t=(0,y.p7)({routes:m,history:e("/")});return t}));async function v(e,t){const s=e(c);s.use(o.Z,t);const a="function"===typeof p["default"]?await(0,p["default"])({}):p["default"],{storeKey:r}=await Promise.resolve().then(n.bind(n,6549)),l=(0,i.Xl)("function"===typeof g?await g({store:a}):g);return a.$router=l,{app:s,store:a,storeKey:r,router:l}}var b=n(6827),w=n(97286),k=n(52941);const x={config:{dark:!0},plugins:{Notify:b.Z,Dialog:w.Z,AppFullscreen:k.Z}};var M=n(70368);(0,M.z)("/service-worker.js",{ready(){},registered(){},cached(){},updatefound(){},updated(){},offline(){},error(){}}),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&window.navigator.standalone&&n.e(736).then(n.t.bind(n,84848,23));const C="/";async function _({app:e,router:t,store:n,storeKey:s},o){let i=!1;const a=e=>{try{return t.resolve(e).href}catch(n){}return Object(e)===e?null:e},r=e=>{if(i=!0,"string"===typeof e&&/^https?:\/\//.test(e))return void(window.location.href=e);const t=a(e);null!==t&&(window.location.href=t)},l=window.location.href.replace(window.location.origin,"");for(let u=0;!1===i&&u<o.length;u++)try{await o[u]({app:e,router:t,store:n,ssrContext:null,redirect:r,urlPath:l,publicPath:C})}catch(d){return d&&d.url?void r(d.url):void console.error("[Quasar] boot error:",d)}!0!==i&&(e.use(t),e.use(n,s),e.mount("#q-app"))}v(s.ri,x).then((e=>Promise.all([Promise.resolve().then(n.bind(n,30711)),Promise.resolve().then(n.bind(n,55635))]).then((t=>{const n=t.map((e=>e.default)).filter((e=>"function"===typeof e));_(e,n)}))))},30711:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>Ot});n(40702);var s=n(59835),o=n(86970),i=n(61957);const a=e=>((0,s.dD)("data-v-899b066a"),e=e(),(0,s.Cn)(),e),r={clickable:"",avatar:"",top:"",class:"relative-position"},l={key:0,class:"is-reply-connector"},d={key:1,class:"has-reply-connector"},u={class:"flex column no-wrap col full-width"},c={class:"q-pb-xs"},p=a((()=>(0,s._)("span",null,"in reply to ",-1))),h={key:3,class:"reposts flex column",clickable:!1},y=["color"],f={class:"text-primary text-thin col q-pl-xs",style:{"font-size":"90%","font-weight":"300"}},m={class:"flex row no-wrap"},g=(0,s.Uk)(" embed "),v=(0,s.Uk)(" repost "),b=(0,s.Uk)(" quote "),w=(0,s.Uk)(" reply "),k={class:"flex row no-wrap items-center"},x=(0,s.Uk)(" cancel "),M=a((()=>(0,s._)("span",{class:"text-caption"}," copy the formatted event ID below and paste it in any post to embed this event ",-1))),C=a((()=>(0,s._)("br",null,null,-1))),_={class:"text-primary",style:{"word-break":"break-all"}},q={key:1,class:"full-width"},S={key:2,style:{"min-height":".5rem"}};function T(e,t,n,a,T,B){const R=(0,s.up)("BaseUserAvatar"),Z=(0,s.up)("q-item-label"),E=(0,s.up)("BaseButtonRelays"),$=(0,s.up)("BaseButtonInfo"),P=(0,s.up)("q-space"),j=(0,s.up)("BaseUserName"),D=(0,s.up)("BaseMarkdown"),W=(0,s.up)("BaseRelayRecommend"),z=(0,s.up)("BasePost",!0),N=(0,s.up)("q-tooltip"),L=(0,s.up)("q-icon"),U=(0,s.up)("q-tab"),I=(0,s.up)("q-tabs"),F=(0,s.up)("q-separator"),O=(0,s.up)("q-btn"),H=(0,s.up)("q-item-section"),A=(0,s.up)("BaseButtonCopy"),Q=(0,s.up)("q-tab-panel"),V=(0,s.up)("BasePostEntry"),J=(0,s.up)("q-tab-panels"),K=(0,s.up)("BasePostThread");return(0,s.wg)(),(0,s.iD)("div",{color:"accent",class:(0,o.C_)(["post-padding cursor-pointer no-hover flex row no-wrap",(e.hasReply?"post-has-reply":"")+(e.isReply?" post-is-reply":"")+(e.highlighted?" post-highlighted":"")+(e.isChildReply?" post-is-child-reply":"")+(e.hasReplyChildren?" post-has-child-reply":"")]),clickable:"","manual-focus":"",onClick:t[13]||(t[13]=(0,i.iM)((t=>e.toEvent(e.event.id)),["stop"]))},[(0,s._)("div",r,[e.isReply?((0,s.wg)(),(0,s.iD)("div",l)):(0,s.kq)("",!0),(0,s.Wm)(R,{pubkey:e.event.pubkey,size:"1.5rem",round:!0,bordered:e.hasReply||e.isReply||e.hasReplyChildren||e.isChildReply,"hover-effect":!0,style:{"z-index":"1"}},null,8,["pubkey","bordered"]),e.hasReply?((0,s.wg)(),(0,s.iD)("div",d)):(0,s.kq)("",!0),"reply"===e.replyMode?((0,s.wg)(),(0,s.iD)("div",{key:2,class:"has-replying-connector",style:(0,o.j5)("height: "+e.postHeight+"px;")},null,4)):(0,s.kq)("",!0),e.hasReplyChildren?((0,s.wg)(),(0,s.iD)("div",{key:3,ref:"hasChildReplyConnector",class:"has-child-reply-connector",style:(0,o.j5)([{visibility:"hidden"},e.childReplyConnectorStyle()])},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.event.replies,((t,n)=>((0,s.wg)(),(0,s.iD)("div",{key:t[0].id,ref_for:!0,ref:"hasChildReplyConnectorTick",class:"has-child-reply-tick",style:(0,o.j5)(e.childReplyTickStyle(n))},null,4)))),128))],4)):(0,s.kq)("",!0)]),(0,s._)("div",u,[(0,s.Wm)(H,{ref:"postContent",class:"relative-position",style:{padding:"0 .2rem"}},{default:(0,s.w5)((()=>[(0,s._)("div",{class:"absolute-top-right flex row items-center post-info",style:{"z-index":"1"},onClick:t[0]||(t[0]=(0,i.iM)((()=>{}),["stop"]))},[(0,s.Wm)(Z,{class:"q-pr-xs",style:{opacity:".8","font-size":"90%"}},{default:(0,s.w5)((()=>[(0,s.Uk)((0,o.zw)(e.niceDate(e.event.created_at)),1)])),_:1}),(0,s.Wm)(E,{"button-class":"text-secondary",event:e.event},null,8,["event"]),(0,s.Wm)($,{"button-class":"text-secondary",event:e.event},null,8,["event"])]),(0,s._)("div",c,[(0,s.Wm)(Z,{caption:"",class:"text-secondary",style:{opacity:".7"}},{default:(0,s.w5)((()=>[(0,s._)("span",{onClick:t[1]||(t[1]=(0,i.iM)((t=>e.toProfile(e.event.pubkey)),["stop"]))},(0,o.zw)(e.shorten(e.event.pubkey)),1)])),_:1}),(0,s.Wm)(P),(0,s.Wm)(Z,{line:1,clickable:""},{default:(0,s.w5)((()=>[(0,s.Wm)(j,{pubkey:e.event.pubkey,"show-verified":!0,class:"text-bold","show-following":!0},null,8,["pubkey"])])),_:1}),!e.tagged||"event"==e.$route.name||e.isReply||e.isChildReply?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(Z,{key:0,class:"q-pl-sm"},{default:(0,s.w5)((()=>[p,(0,s._)("a",{onClick:t[2]||(t[2]=(0,i.iM)((t=>e.toEvent(e.tagged)),["stop"]))},(0,o.zw)(e.shorten(e.tagged)),1)])),_:1}))]),1===e.event.kind?((0,s.wg)(),(0,s.j4)(D,{key:0,"long-form":e.isLongForm,onExpand:t[3]||(t[3]=t=>e.isLongForm=!e.isLongForm)},{default:(0,s.w5)((()=>[(0,s.Uk)((0,o.zw)(e.event.interpolated.text),1)])),_:1},8,["long-form"])):2===e.event.kind?((0,s.wg)(),(0,s.j4)(W,{key:1,url:e.event.content},null,8,["url"])):((0,s.wg)(),(0,s.j4)(D,{key:2},{default:(0,s.w5)((()=>[(0,s.Uk)((0,o.zw)(e.cleanEvent),1)])),_:1})),e.isEmbeded||!e.isQuote&&!e.isRepost?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",h,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.reposts,((n,o)=>((0,s.wg)(),(0,s.j4)(z,{key:n.id+"_"+e.reposts.length+"_"+o,event:n,"manual-focus":!1,"is-embeded":!0,onClick:(0,i.iM)((t=>e.toEvent(n.id)),["stop"]),onResized:t[4]||(t[4]=t=>e.calcConnectorValues(10))},null,8,["event","onClick"])))),128))])),!e.isRepost&&e.$store.state.keys.pub&&-1!==e.replyDepth?((0,s.wg)(),(0,s.iD)("div",{key:4,class:(0,o.C_)(["flex row items-center no-wrap reply-buttons",e.replying?"justify-between":"justify-end"]),color:e.replying?"primary":""},[(0,s._)("div",f,(0,o.zw)(e.replyMode),1),(0,s._)("div",m,[(0,s.Wm)(I,{modelValue:e.replyMode,"onUpdate:modelValue":t[5]||(t[5]=t=>e.replyMode=t),class:"no-padding no-margin",unelevated:"",dense:"",flat:"","active-color":"primary",size:e.highlighted?"md":"sm",onClick:t[6]||(t[6]=(0,i.iM)((()=>{}),["stop"]))},{default:(0,s.w5)((()=>[(0,s.Wm)(U,{name:"embed",class:"no-padding"},{default:(0,s.w5)((()=>[(0,s.Wm)(L,{name:"link"},{default:(0,s.w5)((()=>[(0,s.Wm)(N,null,{default:(0,s.w5)((()=>[g])),_:1})])),_:1})])),_:1}),(0,s.Wm)(U,{name:"repost",class:"no-padding"},{default:(0,s.w5)((()=>[(0,s.Wm)(L,{name:"repeat"},{default:(0,s.w5)((()=>[(0,s.Wm)(N,null,{default:(0,s.w5)((()=>[v])),_:1})])),_:1})])),_:1}),(0,s.Wm)(U,{name:"quote",class:"no-padding"},{default:(0,s.w5)((()=>[(0,s.Wm)(L,{name:"format_quote"},{default:(0,s.w5)((()=>[(0,s.Wm)(N,null,{default:(0,s.w5)((()=>[b])),_:1})])),_:1})])),_:1}),(0,s.Wm)(U,{name:"reply",class:"no-padding"},{default:(0,s.w5)((()=>[(0,s.Wm)(L,{name:"chat_bubble_outline",class:"flip-horizontal"},{default:(0,s.w5)((()=>[(0,s.Wm)(N,null,{default:(0,s.w5)((()=>[w])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue","size"]),(0,s._)("div",k,[e.replyMode?((0,s.wg)(),(0,s.j4)(F,{key:0,color:"primary",size:"1px",vertical:"",spaced:"",class:(0,o.C_)(e.highlighted?"q-mt-sm":"q-mt-xs")},null,8,["class"])):(0,s.kq)("",!0),e.replyMode?((0,s.wg)(),(0,s.j4)(O,{key:1,icon:"close",color:"primary",flat:"",dense:"",onClick:t[7]||(t[7]=(0,i.iM)((t=>e.replyMode=null),["stop"])),size:e.highlighted?"md":"sm"},{default:(0,s.w5)((()=>[(0,s.Wm)(N,null,{default:(0,s.w5)((()=>[x])),_:1})])),_:1},8,["size"])):(0,s.kq)("",!0)])])],10,y)):(0,s.kq)("",!0)])),_:1},512),e.replyMode?((0,s.wg)(),(0,s.j4)(H,{key:0,class:"new-reply-box",ref:"replyContent"},{default:(0,s.w5)((()=>[(0,s.Wm)(J,{modelValue:e.replyPanel,"onUpdate:modelValue":t[10]||(t[10]=t=>e.replyPanel=t),class:"no-padding full-width overflow-hidden",style:{"background-color":"inherit","max-width":"100%",padding:"0 .25 0 0"},onTransition:t[11]||(t[11]=t=>e.calcConnectorValues(10))},{default:(0,s.w5)((()=>[(0,s.Wm)(Q,{name:"embed",class:"no-padding",onClick:t[8]||(t[8]=(0,i.iM)((()=>{}),["stop"]))},{default:(0,s.w5)((()=>[M,(0,s.Wm)(A,{"button-text":"&"+e.event.id,color:"primary",flat:"","tooltip-text":"copy event ID"},null,8,["button-text"]),C,(0,s._)("span",_,(0,o.zw)("&"+e.event.id),1)])),_:1}),(0,s.Wm)(Q,{name:"reply",class:"q-pa-sm"},{default:(0,s.w5)((()=>[(0,s.Wm)(V,{event:e.event,"reply-mode":e.replyMode,onSent:e.replySent,onResized:t[9]||(t[9]=t=>e.calcConnectorValues(10))},null,8,["event","reply-mode","onSent"])])),_:1})])),_:1},8,["modelValue"])])),_:1},512)):(0,s.kq)("",!0),e.hasReplyChildren?((0,s.wg)(),(0,s.iD)("div",q,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.event.replies,(n=>((0,s.wg)(),(0,s.iD)("div",{key:n[0].id,ref_for:!0,ref:"childReplyContent"},[(0,s.Wm)(K,{events:n,"reply-depth":e.replyDepth+1,onResized:t[12]||(t[12]=t=>e.calcConnectorValues(10)),onAddEvent:e.addEvent},null,8,["events","reply-depth","onAddEvent"])])))),128))])):(0,s.kq)("",!0),e.isRepost?((0,s.wg)(),(0,s.iD)("div",S)):(0,s.kq)("",!0)])],2)}var B=n(22330),R=n(18933),Z=n(73270),E=n(51607),$=n(68067),P=n(63602),j=n(37139);const D=(0,s.aZ)({name:"BasePost",emits:["resized","add-event","mounted"],mixins:[R.Z],props:{event:{type:Object,required:!0},highlighted:{type:Boolean,default:!1},position:{type:String,default:"standalone"},replyDepth:{type:Number,default:0},isEmbeded:{type:Boolean,default:!1}},components:{BaseButtonRelays:Z.Z,BaseButtonInfo:E.Z,BaseButtonCopy:$.Z,BaseMarkdown:P.Z,BaseRelayRecommend:j.Z},data(){return{clicking:!1,replying:!1,childReplyHeights:[],postHeight:0,replyHeight:0,reposts:[],eventSub:null,replyMode:"",resizing:!1,trigger:1,isLongForm:!1}},computed:{tagged(){var e;let t=null===(e=this.event.interpolated)||void 0===e?void 0:e.replyEvents;return null!==t&&void 0!==t&&t.length?t[t.length-1]:null},isRepost(){var e;return""===(null===(e=this.event.interpolated)||void 0===e?void 0:e.text)&&this.event.interpolated.mentionEvents.length},isQuote(){var e;return(null===(e=this.event.interpolated)||void 0===e?void 0:e.text)&&this.event.interpolated.mentionEvents.length},mentionEvents(){var e;return null===(e=this.event.interpolated)||void 0===e?void 0:e.mentionEvents},isReply(){return"middle"===this.position||"last"===this.position},hasReply(){return"middle"===this.position||"first"===this.position},isChildReply(){return!!this.replyDepth},hasReplyChildren(){return!!(this.event.replies&&this.event.replies.length>0)},postContentWidth(){var e,t,n,s;return this.resizing?null===(e=this.$refs.postContent)||void 0===e||null===(t=e.$el)||void 0===t?void 0:t.clientWidth:null===(n=this.$refs.postContent)||void 0===n||null===(s=n.$el)||void 0===s?void 0:s.clientWidth},postContentHeight(){var e,t,n,s;return this.resizing?null===(e=this.$refs.postContent)||void 0===e||null===(t=e.$el)||void 0===t?void 0:t.clientHeight:null===(n=this.$refs.postContent)||void 0===n||null===(s=n.$el)||void 0===s?void 0:s.clientHeight},replyContentHeight(){var e,t,n,s,o;return this.replyMode&&this.resizing&&null!==(e=this.$refs.replyContent)&&void 0!==e&&e.$el?null===(t=this.$refs.replyContent)||void 0===t||null===(n=t.$el)||void 0===n?void 0:n.clientHeight:(null===(s=this.$refs.replyContent)||void 0===s||null===(o=s.$el)||void 0===o?void 0:o.clientHeight)||0},replyPanel(){return"embed"===this.replyMode?"embed":this.replyMode?"reply":""},cleanEvent(){return JSON.stringify((0,B.CX)(this.event),null,"\n\t")}},mounted(){this.isEmbeded||!this.isQuote&&!this.isRepost||(Array.isArray(this.reposts)||(this.reposts=[]),this.processTaggedEvents(this.mentionEvents,this.reposts)),this.calcConnectorValues(),this.$emit("mounted"),this.isLongForm=this.event.interpolated.text.length>500},activated(){this.calcConnectorValues(),this.trigger++},deactivated(){if(this.reposts.length)for(let e of this.reposts)this.$store.dispatch("cancelUseProfile",{pubkey:e.pubkey})},methods:{childReplyConnectorStyle(){var e;if(null!==(e=this.childReplyHeights)&&void 0!==e&&e.length){let e=this.postHeight+this.childReplyHeights.slice(0,-1).reduce(((e,t)=>e+t),0);return this.replyHeight&&(e+=this.replyHeight),"visibility: visible; height: "+e+"px"}return""},childReplyTickStyle(e){var t;if(null!==(t=this.childReplyHeights)&&void 0!==t&&t.length){let t=this.postHeight+this.childReplyHeights.filter(((t,n)=>n<e)).reduce(((e,t)=>e+t),0);return this.replyHeight&&(t+=this.replyHeight),"visibility: visible; top: "+t+"px"}return""},calcConnectorValues(e=2e3){this.resizing=!this.resizing,(0,s.Y3)((()=>{setTimeout((()=>{var e;(this.postHeight=this.postContentHeight,this.replyHeight=this.replyContentHeight,this.hasReplyChildren)&&(this.childReplyHeights=null===(e=this.$refs.childReplyContent)||void 0===e?void 0:e.map((e=>e.clientHeight)));this.$emit("resized")}),e)}))},toggleReplying(){""===this.replyMode?(this.replying=!0,this.replyMode="reply"):(this.replyMode="",this.replying=!1),this.calcConnectorValues(10)},replySent(e){this.replying=!1,this.replyMode="",this.$emit("add-event",e)},niceDate(e){return this.trigger,this.niceDateUTC(e)},addEvent(e){console.log("post reply threads add-event",e),this.$emit("add-event",e)}}});var W=n(11639),z=n(76749),N=n(33115),L=n(90136),U=n(47817),I=n(70900),F=n(22857),O=n(46858),H=n(50926),A=n(24455),Q=n(89800),V=n(84106),J=n(69984),K=n.n(J);const Y=(0,W.Z)(D,[["render",T],["__scopeId","data-v-899b066a"]]),X=Y;K()(D,"components",{QItemSection:z.Z,QItemLabel:N.Z,QSpace:L.Z,QTabs:U.Z,QTab:I.Z,QIcon:F.Z,QTooltip:O.Z,QSeparator:H.Z,QBtn:A.Z,QTabPanels:Q.Z,QTabPanel:V.Z});const G={key:0,class:"text-bold flex row no-wrap items-center",style:{gap:".2rem"},clickable:""},ee=(0,s.Uk)(" following "),te={class:"flex row no-wrap items-center"},ne={key:0,style:{opacity:".9","font-size":"90%","font-weight":"300","line-height":"90%"}};function se(e,t,n,a,r,l){const d=(0,s.up)("q-tooltip"),u=(0,s.up)("q-icon"),c=(0,s.up)("BaseButtonNIP05");return(0,s.wg)(),(0,s.iD)("div",{class:(0,o.C_)(["cursor-pointer flex",(n.alignRight?" justify-end":" justify-start")+(n.headerMode?" column items-start":" row items-center")+(n.wrap?"":" no-wrap")]),onClick:t[0]||(t[0]=(0,i.iM)((t=>e.toProfile(n.pubkey)),["stop"])),style:(0,o.j5)([{gap:".1rem"},n.alignRight?"text-align: right;":"text-align: left"])},[e.$store.getters.name(n.pubkey)?((0,s.wg)(),(0,s.iD)("div",G,[(0,s.Uk)((0,o.zw)(e.$store.getters.name(n.pubkey))+" ",1),n.showFollowing&&l.isFollow?((0,s.wg)(),(0,s.j4)(u,{key:0,name:"visibility",size:n.headerMode?"sm":"xs",color:"secondary"},{default:(0,s.w5)((()=>[(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[ee])),_:1})])),_:1},8,["size"])):(0,s.kq)("",!0)])):(0,s.kq)("",!0),(0,s._)("div",te,[(0,s.Wm)(c,{pubkey:n.pubkey,"button-size":n.headerMode?"sm":"xs"},null,8,["pubkey","button-size"]),e.$store.getters.NIP05Id(n.pubkey)?((0,s.wg)(),(0,s.iD)("div",ne,(0,o.zw)(l.niceNIP05),1)):(0,s.kq)("",!0)])],6)}n(46727);const oe={class:"flex row justify-end"},ie={class:"overflow-auto"},ae={class:"text-subtitle1 flex row overflow-auto items-end q-gutter-sm"},re=(0,s.Uk)(" NIP05 identifier "),le=["href"],de={key:0},ue=(0,s._)("div",null,[(0,s.Uk)("learn how to get NIP05 verified "),(0,s._)("a",{href:"https://gist.github.com/metasikander/609a538e6a03b2f67e5c8de625baed3e",target:"_"},"here")],-1),ce=(0,s.Uk)(" NIP05 verified ");function pe(e,t,n,a,r,l){const d=(0,s.up)("q-btn"),u=(0,s.up)("q-spinner-orbit"),c=(0,s.up)("q-inner-loading"),p=(0,s.up)("q-card-section"),h=(0,s.up)("q-card"),y=(0,s.up)("q-dialog"),f=(0,s.up)("q-tooltip"),m=(0,s.Q2)("close-popup");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(y,{modelValue:r.NIP05Dialog,"onUpdate:modelValue":t[0]||(t[0]=e=>r.NIP05Dialog=e)},{default:(0,s.w5)((()=>[(0,s.Wm)(h,{class:"flex column no-wrap",style:{"max-height":"90%"}},{default:(0,s.w5)((()=>[(0,s._)("div",oe,[(0,s.wy)((0,s.Wm)(d,{icon:"close",flat:"",dense:""},null,512),[[m]])]),(0,s._)("div",ie,[(0,s.Wm)(p,null,{default:(0,s.w5)((()=>[(0,s._)("div",ae,[re,(0,s._)("a",{href:l.NIP05Link,target:"_"},(0,o.zw)(l.NIP05Link),9,le)]),l.NIP05Loaded?((0,s.wg)(),(0,s.iD)("pre",de,(0,o.zw)(l.NIP05Formatted),1)):(0,s.kq)("",!0),(0,s.Wm)(c,{showing:!l.NIP05Loaded},{default:(0,s.w5)((()=>[(0,s.Wm)(u,{color:"accent",size:"2rem"})])),_:1},8,["showing"]),ue])),_:1})])])),_:1})])),_:1},8,["modelValue"]),e.$store.getters.NIP05Id(n.pubkey)?((0,s.wg)(),(0,s.j4)(d,{key:0,icon:"verified",color:"accent",flat:"",dense:"",size:n.buttonSize,class:"no-padding",clickable:"",onClick:(0,i.iM)(l.openNIP05,["stop"])},{default:(0,s.w5)((()=>[(0,s.Wm)(f,null,{default:(0,s.w5)((()=>[ce])),_:1})])),_:1},8,["size","onClick"])):(0,s.kq)("",!0)],64)}var he=n(33688),ye=n.n(he),fe=n(6827);const me={mixins:[R.Z],props:{pubkey:{type:String,required:!0},buttonSize:{type:String,default:"xs"}},data(){return{NIP05Dialog:!1,NIP05Data:{}}},computed:{NIP05Link(){let[e,t]=this.$store.getters.NIP05Id(this.pubkey).split("@");return t||(t=e,e="_"),`https://${t}/.well-known/nostr.json?name=${e}`},NIP05Formatted(){return this.json(this.NIP05Data)},NIP05Loaded(){return!!Object.keys(this.NIP05Data).length}},methods:{openNIP05(){this.loadNIP05Data(),this.NIP05Dialog=!this.NIP05Dialog},async loadNIP05Data(){try{this.NIP05Data=await(await ye()(this.NIP05Link)).json()}catch(e){fe.Z.create({message:"failed to fetch NIP05 identifier",color:"negative"})}}}};var ge=n(87743),ve=n(44458),be=n(63190),we=n(60854),ke=n(10786),xe=n(62146);const Me=(0,W.Z)(me,[["render",pe]]),Ce=Me;K()(me,"components",{QDialog:ge.Z,QCard:ve.Z,QBtn:A.Z,QCardSection:be.Z,QInnerLoading:we.Z,QSpinnerOrbit:ke.Z,QTooltip:O.Z}),K()(me,"directives",{ClosePopup:xe.Z});const _e={mixins:[R.Z],components:{BaseButtonNIP05:Ce},props:{pubkey:{type:String,required:!0},wrap:{type:Boolean,default:!1},alignRight:{type:Boolean,default:!1},headerMode:{type:Boolean,default:!1},showFollowing:{type:Boolean,default:!1}},computed:{niceNIP05(){return this.$store.getters.NIP05Id(this.pubkey).split("@").map((e=>"_"===e||e===this.$store.getters.name(this.pubkey)?"":e)).join("@")},isFollow(){return this.$store.state.following.includes(this.pubkey)}}},qe=(0,W.Z)(_e,[["render",se]]),Se=qe;K()(_e,"components",{QIcon:F.Z,QTooltip:O.Z});const Te=["src"];function Be(e,t,n,a,r,l){const d=(0,s.up)("BaseButtonNIP05"),u=(0,s.up)("q-avatar");return(0,s.wg)(),(0,s.iD)("div",{class:(0,o.C_)((n.bordered?"bordered-avatar":"")+(n.hoverEffect?" hovered-avatar":""))},[(0,s.Wm)(u,{rounded:!n.round,class:"relative-position",size:n.size,onClick:t[0]||(t[0]=(0,i.iM)((t=>e.toProfile(n.pubkey)),["stop"]))},{default:(0,s.w5)((()=>[(0,s._)("img",{src:e.$store.getters.avatar(n.pubkey),crossorigin:"",async:""},null,8,Te),(0,s._)("div",{class:(0,o.C_)([n.alignRight?"icon-right":"icon-left","q-pt-xs"])},[n.showVerified?((0,s.wg)(),(0,s.j4)(d,{key:0,pubkey:n.pubkey,"button-size":"xs"},null,8,["pubkey"])):(0,s.kq)("",!0)],2)])),_:1},8,["rounded","size"])],2)}const Re={mixins:[R.Z],components:{BaseButtonNIP05:Ce},props:{pubkey:{type:String,required:!0},alignRight:{type:Boolean,default:!1},size:{type:String,default:""},round:{type:Boolean,default:!1},bordered:{type:Boolean,default:!1},showVerified:{type:Boolean,default:!1},hoverEffect:{type:Boolean,default:!1}}};var Ze=n(61357);const Ee=(0,W.Z)(Re,[["render",Be],["__scopeId","data-v-7ace2702"]]),$e=Ee;K()(Re,"components",{QAvatar:Ze.Z});var Pe=n(36345);const je=e=>((0,s.dD)("data-v-55bc36e0"),e=e(),(0,s.Cn)(),e),De={key:1,clickable:!1,class:"embeded-message q-px-sm q-py-xs"},We={class:"relative-position"},ze={class:"input-area"},Ne={id:"input-placeholder"},Le={id:"input-readonly-highlight",contenteditable:"true",spellcheck:"false"},Ue=["contenteditable"],Ie=je((()=>(0,s._)("div",{id:"input-readonly",contenteditable:"true",spellcheck:"false"},null,-1))),Fe={key:0,class:"absolute-top full-width row justify-center q-my-md"},Oe={style:{"font-size":".9rem"}},He={key:0,class:"q-pl-xs"},Ae=je((()=>(0,s._)("div",{class:"text-secondary"},"links added",-1))),Qe={dense:"",style:{"font-size":".8rem","font-weight":"300"}},Ve={class:"col-11",style:{"overflow-x":"auto"}},Je={class:"flex row justify-between"},Ke=je((()=>(0,s._)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24"},[(0,s._)("path",{d:"M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0m0 22C6.486 22 2 17.514 2 12S6.486 2 12 2s10 4.486 10 10-4.486 10-10 10"}),(0,s._)("path",{d:"M8 7a2 2 0 1 0-.001 3.999A2 2 0 0 0 8 7M16 7a2 2 0 1 0-.001 3.999A2 2 0 0 0 16 7M15.232 15c-.693 1.195-1.87 2-3.349 2-1.477 0-2.655-.805-3.347-2H15m3-2H6a6 6 0 1 0 12 0"})],-1))),Ye=(0,s.Uk)(" add emoji "),Xe=(0,s.Uk)(" add link "),Ge=(0,s.Uk)(" cancel "),et={key:1,class:"char-left-label"},tt={key:0,class:"over-limit"},nt=(0,s.Uk)(" short form post "),st=(0,s.Uk)(" long form post ");function ot(e,t,n,a,r,l){const d=(0,s.up)("BasePost"),u=(0,s.up)("q-btn"),c=(0,s.up)("BaseMessage"),p=(0,s.up)("q-list"),h=(0,s.up)("BaseUserAvatar"),y=(0,s.up)("q-spinner-orbit"),f=(0,s.up)("q-icon"),m=(0,s.up)("q-tooltip"),g=(0,s.up)("q-btn-toggle"),v=(0,s.up)("q-separator"),b=(0,s.up)("BaseEmojiPicker"),w=(0,s.up)("q-tab-panel"),k=(0,s.up)("BaseLinkForm"),x=(0,s.up)("q-tab-panels"),M=(0,s.up)("q-item"),C=(0,s.up)("q-circular-progress"),_=(0,s.up)("q-btn-group");return(0,s.wg)(),(0,s.j4)(M,{unelevated:"",class:"q-pa-none post-entry-form flex coloumn",ref:"postEntry",onClick:t[18]||(t[18]=(0,i.iM)((()=>{}),["stop"])),onMouseup:t[19]||(t[19]=(0,i.iM)((()=>{}),["stop"])),onKeypress:t[20]||(t[20]=(0,i.D2)((0,i.iM)((()=>{}),["stop"]),["enter"])),onKeydown:t[21]||(t[21]=(0,i.iM)((()=>{}),["stop"])),onKeyup:t[22]||(t[22]=(0,i.iM)((()=>{}),["stop"]))},{default:(0,s.w5)((()=>["quote"===n.replyMode||"repost"===n.replyMode?((0,s.wg)(),(0,s.iD)("div",{key:0,class:(0,o.C_)(["reposts flex column q-px-sm q-py-xs","quote"===n.replyMode?"q-mb-sm":""]),clickable:!1},[(0,s.Wm)(d,{event:n.event,clickable:!1,"is-embeded":!0,"reply-depth":-1},null,8,["event"])],2)):(0,s.kq)("",!0),"reply"===n.messageMode&&n.event?((0,s.wg)(),(0,s.iD)("div",De,[(0,s._)("div",We,[(0,s.Wm)(u,{icon:"close",flat:"",dense:"",onClick:t[0]||(t[0]=(0,i.iM)((t=>e.$emit("clear-event")),["stop"])),size:"xs",class:"absolute-top-right z-top"})]),n.event?((0,s.wg)(),(0,s.j4)(c,{key:0,event:n.event,clickable:!1,"is-embeded":!0},null,8,["event"])):(0,s.kq)("",!0)])):(0,s.kq)("",!0),(0,s.wy)((0,s._)("div",{class:"relative-position full-width",style:{gap:"5px"},onClick:t[9]||(t[9]=(0,i.iM)((()=>{}),["stop"]))},[(0,s.Wm)(p,{id:"tribute-wrapper",class:"overflow-auto flex row z-top",style:{"max-height":"70vh"},onClick:(0,i.iM)(r.focusInput,["stop"])},null,8,["onClick"]),(0,s._)("div",ze,[(0,s.Wm)(h,{pubkey:e.$store.state.keys.pub,class:"avatar-image"},null,8,["pubkey"]),(0,s._)("span",Ne,(0,o.zw)(l.placeholderText),1),(0,s.wy)((0,s._)("div",Le,null,512),[[i.F8,!r.longForm]]),(0,s._)("div",{id:"input-editable",contenteditable:!r.sending&&!r.mentionsUpdating,style:(0,o.j5)(r.mentionsUpdating?"opacity: .7;":""),onInput:t[1]||(t[1]=(...e)=>l.updateText&&l.updateText(...e)),onKeypress:[t[2]||(t[2]=(0,i.D2)(((...e)=>l.updateText&&l.updateText(...e)),["delete"])),t[5]||(t[5]=(0,i.D2)((0,i.iM)(((...e)=>l.send&&l.send(...e)),["ctrl"]),["enter"]))],onFocus:t[3]||(t[3]=(...e)=>l.textareaFocus&&l.textareaFocus(...e)),onBlur:t[4]||(t[4]=(...e)=>l.textareaBlur&&l.textareaBlur(...e)),onClick:t[6]||(t[6]=(0,i.iM)(((...e)=>l.updateText&&l.updateText(...e)),["stop"])),onTouchstart:t[7]||(t[7]=(0,i.iM)((()=>{}),["stop"])),onMousedown:t[8]||(t[8]=(0,i.iM)((()=>{}),["stop"]))},null,44,Ue),Ie,r.mentionsUpdating?((0,s.wg)(),(0,s.iD)("div",Fe,[(0,s.Wm)(y,{color:"accent",size:"md"})])):(0,s.kq)("",!0)])],512),[[i.F8,"repost"!==n.replyMode]]),(0,s._)("div",Oe,[r.links.length?((0,s.wg)(),(0,s.iD)("div",He,[Ae,(0,s._)("ul",Qe,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(r.links,((e,t)=>((0,s.wg)(),(0,s.iD)("li",{key:t,class:"flex row justify-between no-wrap",dense:""},[(0,s._)("div",Ve,[(0,s._)("strong",null,(0,o.zw)(l.linkName(e)),1),(0,s._)("span",null,(0,o.zw)(e.url),1)]),(0,s.Wm)(u,{icon:"remove_circle",clickable:"",onClick:(0,i.iM)((e=>l.removeLink(t)),["stop"]),flat:"",color:"negative",size:"xs",class:"no-padding"},null,8,["onClick"])])))),128))])])):(0,s.kq)("",!0)]),(0,s._)("div",{class:(0,o.C_)(["flex justify-between",r.toolSelected?"column":"row"]),onClick:t[17]||(t[17]=(0,i.iM)((()=>{}),["stop"]))},[(0,s._)("div",Je,[(0,s.wy)((0,s.Wm)(g,{modelValue:r.toolSelected,"onUpdate:modelValue":t[12]||(t[12]=e=>r.toolSelected=e),class:(0,o.C_)(["flex",r.toolSelected?"column":"row"]),dense:"",unelevated:"","toggle-color":"","toggle-text-color":"accent",options:[{value:"emoji",slot:"emoji"},{value:"link",slot:"link"}]},{emoji:(0,s.w5)((()=>[(0,s.Wm)(u,{unelevated:"",class:"no-padding button-emoji",dense:"",size:"sm",onClick:t[10]||(t[10]=(0,i.iM)((e=>l.toggleTool("emoji")),["stop"]))},{default:(0,s.w5)((()=>[(0,s.Wm)(f,null,{default:(0,s.w5)((()=>[Ke])),_:1}),(0,s.Wm)(m,null,{default:(0,s.w5)((()=>[Ye])),_:1})])),_:1})])),link:(0,s.w5)((()=>[(0,s.Wm)(u,{unelevated:"",class:"no-padding button-link",dense:"",size:"sm",onClick:t[11]||(t[11]=(0,i.iM)((e=>l.toggleTool("link")),["stop"]))},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{name:"add_link",size:"sm"}),(0,s.Wm)(m,null,{default:(0,s.w5)((()=>[Xe])),_:1})])),_:1})])),_:1},8,["modelValue","class"]),[[i.F8,"repost"!==n.replyMode]]),r.toolSelected?((0,s.wg)(),(0,s.j4)(M,{key:0,class:"col toolbox no-padding",ref:"toolbox"},{default:(0,s.w5)((()=>[(0,s.Wm)(v,{vertical:"",color:"accent",size:"1px"}),(0,s.Wm)(x,{modelValue:r.toolSelected,"onUpdate:modelValue":t[15]||(t[15]=e=>r.toolSelected=e),class:"no-padding full-width"},{default:(0,s.w5)((()=>[(0,s.Wm)(w,{name:"emoji",class:"no-padding",onClick:t[13]||(t[13]=(0,i.iM)((()=>{}),["stop"]))},{default:(0,s.w5)((()=>[(0,s.Wm)(b,{onEmojiSelected:l.insertEmoji,"per-line":l.emojiPerRow,class:"full-width"},null,8,["onEmojiSelected","per-line"])])),_:1}),(0,s.Wm)(w,{name:"link",class:"q-pa-xs",onClick:t[14]||(t[14]=(0,i.iM)((()=>{}),["stop"]))},{default:(0,s.w5)((()=>[(0,s.Wm)(k,{links:r.links,onLinkAdded:l.addLink},null,8,["links","onLinkAdded"])])),_:1})])),_:1},8,["modelValue"])])),_:1},512)):(0,s.kq)("",!0)]),(0,s.Wm)(_,{class:"flex items-center",unelevated:""},{default:(0,s.w5)((()=>[r.toolSelected?((0,s.wg)(),(0,s.j4)(u,{key:0,icon:"close",unelevated:"",class:"col button-close",dense:"",onClick:(0,i.iM)(l.closeTools,["stop"])},{default:(0,s.w5)((()=>[(0,s.Wm)(m,null,{default:(0,s.w5)((()=>[Ge])),_:1})])),_:1},8,["onClick"])):(0,s.kq)("",!0),r.text&&!n.messageMode?((0,s.wg)(),(0,s.iD)("div",et,[l.charLeft()<=0&&!r.longForm?((0,s.wg)(),(0,s.iD)("span",tt,(0,o.zw)(l.charLeft()),1)):(0,s.kq)("",!0),l.charLeft()>0?((0,s.wg)(),(0,s.j4)(C,{key:1,"show-value":l.charLeft()<=25,value:r.text.length%r.charLimit/r.charLimit*100,size:l.charLeft()<=25?"1.5rem":"1.2rem","font-size":".6rem",thickness:l.charLeft()<=25?.2:.1,color:l.charLeft()<=25?"warning":"secondary","track-color":"transparent",class:"no-padding","instant-feedback":""},{default:(0,s.w5)((()=>[(0,s.Uk)((0,o.zw)(l.charLeft()),1)])),_:1},8,["show-value","value","size","thickness","color"])):(0,s.kq)("",!0)])):(0,s.kq)("",!0),l.charLeft()<=0?((0,s.wg)(),(0,s.j4)(g,{key:2,modelValue:r.longForm,"onUpdate:modelValue":t[16]||(t[16]=e=>r.longForm=e),unelevated:"",dense:"","toggle-color":"primary",style:{border:"1px solid var(--q-primary)"},"text-color":"primary",class:"q-ml-md",options:[{value:!1,slot:"short"},{value:!0,slot:"long"}]},{short:(0,s.w5)((()=>[(0,s.Wm)(f,{name:"short_text",size:"xs",style:(0,o.j5)(r.longForm?"":"color: var(--q-background")},null,8,["style"]),(0,s.Wm)(m,null,{default:(0,s.w5)((()=>[nt])),_:1})])),long:(0,s.w5)((()=>[(0,s.Wm)(f,{name:"format_align_left",size:"xs",style:(0,o.j5)(r.longForm?"color: var(--q-background":"")},null,8,["style"]),(0,s.Wm)(m,null,{default:(0,s.w5)((()=>[st])),_:1})])),_:1},8,["modelValue"])):(0,s.kq)("",!0),(0,s.Wm)(u,{flat:"",unelevated:"",color:"primary",type:"submit",onClick:(0,i.iM)(l.send,["stop"]),disable:!l.textValid()},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{name:"send",style:(0,o.j5)("transform: translateX("+r.sendIconTranslation+"px);")},null,8,["style"])])),_:1},8,["onClick","disable"])])),_:1})],2)])),_:1},512)}n(38049),n(18964),n(42498);var it=n(75103),at=n(26041);function rt(e,t,n,o,a,r){const l=(0,s.up)("Picker");return(0,s.wg)(),(0,s.j4)(l,{data:a.emojiIndex,native:!0,"emoji-size":16,"per-line":n.perLine,"show-preview":!1,"show-skin-tomes":!1,onSelect:r.emojiSelected,onClick:t[0]||(t[0]=(0,i.iM)((()=>{}),["stop"]))},null,8,["data","per-line","onSelect"])}var lt=n(9022),dt=n(14476);let ut=new dt.xd(lt);const ct={name:"BaseEmojiPicker",emits:["emoji-selected"],props:{perLine:{type:Number,required:!0}},components:{Picker:dt.cW},data(){return{emojiIndex:ut}},methods:{emojiSelected(e){this.$emit("emoji-selected",e)}}},pt=(0,W.Z)(ct,[["render",rt]]),ht=pt;function yt(e,t,n,o,i,a){const r=(0,s.up)("q-input"),l=(0,s.up)("q-btn"),d=(0,s.up)("q-form");return(0,s.wg)(),(0,s.j4)(d,{onSubmit:t[2]||(t[2]=e=>a.addLink({url:i.url,name:i.name})),class:"no-padding flex row items-center no-wrap justify-between"},{default:(0,s.w5)((()=>[(0,s.Wm)(r,{modelValue:i.url,"onUpdate:modelValue":t[0]||(t[0]=e=>i.url=e),type:"url",label:"url",dense:"",outlined:"",autofocus:"",color:"accent",class:"no-padding col-9"},null,8,["modelValue"]),(0,s.Wm)(r,{modelValue:i.name,"onUpdate:modelValue":t[1]||(t[1]=e=>i.name=e),label:"url name",disable:0===i.url.length,outlined:"",dense:"",color:"accent",class:"no-padding col-2"},null,8,["modelValue","disable"]),(0,s.Wm)(l,{icon:"add",type:"submit",disable:0===i.url.length,outline:"",round:"",color:"accent",size:"sm",class:"no-padding"},null,8,["disable"])])),_:1})}const ft={name:"BaseLinkForm",emits:["link-added","link-removed"],props:{links:{type:Array,required:!0}},data(){return{url:"",name:""}},methods:{linkName(e){return e.name?`${e.name}: `:""},addLink(e){0===e.name.length&&delete e.name,this.$emit("link-added",e),this.url="",this.name=""},removeLink(e){this.$emit("link-removed",e)}}};var mt=n(8326),gt=n(66611);const vt=(0,W.Z)(ft,[["render",yt]]),bt=vt;K()(ft,"components",{QForm:mt.Z,QInput:gt.Z,QBtn:A.Z});var wt=n(3475);const{getPaletteColor:kt}=it.ZP,xt={name:"BasePostEntry",mixins:[R.Z],emits:["sent","resized","clear-event"],components:{BaseEmojiPicker:ht,BaseLinkForm:bt,BaseMessage:wt.Z},props:{messageMode:{type:String,required:!1,default:""},replyMode:{type:String,required:!1,default:""},event:{type:Object,required:!1,default:null},autoFocus:{type:Boolean,default:!0}},data(){return{text:"",charLimit:280,sending:!1,toolSelected:"",sendIconTranslation:0,tags:[],mentionsUpdating:!1,focusInput(){setTimeout((async()=>{await this.$nextTick(),this.textarea.focus()}),1)},trigger:1,links:[],textareaRange:null,longForm:!1}},watch:{text(e,t){this.updateMentionsTags()},replyMode(e,t){e!==t&&(this.$emit("resized"),this.focusInput())},messageMode(e,t){e!==t&&(this.$emit("resized"),this.focusInput())}},computed:{postEntry(){return this.$refs.postEntry.$el},textarea(){return this.postEntry.querySelector("#input-editable")},readonlyTextarea(){return this.postEntry.querySelector("#input-readonly")},readonlyHighlightTextarea(){return this.postEntry.querySelector("#input-readonly-highlight")},placeholder(){return this.postEntry.querySelector("#input-placeholder")},profileMentionsProvider(){return this.createMentionsProvider()},postEntryWidth(){var e,t;return null===(e=this.$refs.postEntry)||void 0===e||null===(t=e.$el)||void 0===t?void 0:t.clientWidth},toolboxWidth(){var e,t;return this.toolSelected?null===(e=this.$refs.toolbox)||void 0===e||null===(t=e.$el)||void 0===t?void 0:t.clientWidth:0},emojiPerRow(){return this.toolboxWidth?Math.floor((this.toolboxWidth-10)/25):0},label(){if("reply"===this.messageMode)return"what's your reply?";if(this.messageMode)return"what's your message?";if(this.replyMode){if("reply"===this.replyMode)return"what's your reply?";if("quote"===this.replyMode)return"what's your thought?"}return"what's happening?"},placeholderText(){if(this.text.length)return"";if("reply"===this.messageMode)return"reply to message";if(this.messageMode)return"what's your message?";if(this.replyMode){if("reply"===this.replyMode)return"what's your reply?";if("quote"===this.replyMode)return"what's your thought on this?"}return"what's happening?"},textareaMentions(){return this.mentions()},hashtags(){if(0===this.text.length)return[];const e=/#(?<i>[\w]{1,63})/g;let t=this.text.matchAll(e),n=[];for(let s of t)n.push(s.groups.i.toLowerCase());return n},caretRange(){const e="undefined"!==typeof window.getSelection;if(e&&this.trigger){const e=window.getSelection();if(0!==e.rangeCount){const t=e.getRangeAt(0);return t}}return null}},mounted(){this.messageMode||this.profileMentionsProvider.attach(this.textarea),this.autoFocus&&this.focusInput(),this.$emit("resized")},activated(){},beforeUnmount(){this.messageMode||this.profileMentionsProvider.detach(this.textarea),this.reset(),this.$emit("resized")},methods:{updateText(e){this.trigger++,this.text=this.textarea.textContent,this.textareaRange=this.caretRange,this.updateReadonlyInput(),this.messageMode||this.updateReadonlyHightlightInput()},async send(){if(!this.textValid())return void console.log("text not valid");if(this.sending)return void console.log("send already in progress");let e;this.toolSelected="",this.sending=!0,this.animateSendIcon(),await this.extractMentions(this.textarea,this.tags),e=this.replyMode?await this.sendReply():this.messageMode?await this.sendMessage():await this.sendPost(),e&&(this.messageMode||this.interpolateEventMentions(e),this.reset(),this.$emit("sent",e),this.replyMode||this.messageMode||this.toEvent(e.id)),this.sending=!1},async sendPost(){let e=Object.values(this.mentions()).map((e=>e.tag)),t=await this.formatMentionsForPublishing(e);this.appendHashtags(e),t=this.appendLinks(t);let n=await this.$store.dispatch("sendPost",{message:t,tags:e});if(n)return n},async sendReply(){"repost"===this.replyMode&&this.text&&(this.textarea.innerHTML="");let e=[],t=this.textarea.cloneNode(!0),n=this.event.tags.filter((([e,t])=>("p"===e||"e"===e)&&t)).map((([...e])=>[...e])),s=n.filter((([e,t])=>"p"===e)).map((([e,t])=>t));for(let i=0;i<Math.min(4,s.length);i++)e.push(await(0,at.l_)(s[s.length-1-i]));if(e.find((([e,t])=>t===this.event.pubkey))||e.push(await(0,at.l_)(this.event.pubkey)),e=e.filter((([e,t])=>t!==this.$store.state.keys.pub)),"quote"===this.replyMode||"repost"===this.replyMode){let n=await(0,at.wn)(this.event.id,"mention");e.push(n),t.append(` #[${e.length-1}]`)}else{let t=n.find((([e,t,n,s])=>"e"===e&&"root"===s))||n.find((e=>"e"===e[0]&&!e[3]));t?(e.push(await(0,at.wn)(t[1],"root")),e.push(await(0,at.wn)(this.event.id,"reply"))):e.push(await(0,at.wn)(this.event.id,"root"))}let o=await this.formatMentionsForPublishing(e,t);return this.appendHashtags(e),o=this.appendLinks(o),await this.$store.dispatch("sendPost",{message:o,tags:e})},async sendMessage(){let e=Math.round(Date.now()/1e3),t=[];t.find((([e,t])=>t===this.$route.params.pubkey))||t.push(["p",this.$route.params.pubkey]),this.event&&!t.find((([e,t])=>t===this.event.id))&&t.push(["e",this.event.id]);let n=await this.formatMentionsForPublishing(t);return n=this.appendLinks(n),console.log("sendChatMessage",{now:e,pubkey:this.$route.params.pubkey,text:n,tags:t}),await this.$store.dispatch("sendChatMessage",{now:e,pubkey:this.$route.params.pubkey,text:n,tags:t})},async extractMentions(e,t){const n=/(?<t>[@&]{1})(?<v>[a-f0-9]{64})\b/g,s=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1);let o={},i=s.nextNode();while(i){let e=i.textContent;for(let s of e.matchAll(n)){let e=null;if("&"===s.groups.t)e="e";else{if("@"!==s.groups.t)return;e="p"}let n=s.groups.v,i=Object.entries(t),a=i.map((([e,t])=>t)).findIndex((([t,s])=>t===e&&s===n));if(-1!==a)o[n]=i[a][0];else if("e"===e){let e=`event${(0,at.OV)(n)}`;t[e]=["e",n],o[n]=e}else{let e=`@${this.$store.getters.displayName(n)}`;t[e]=await(0,at.l_)(n),o[n]=e}}e=e.replace(n,((e,t,n)=>o[n])),i.textContent=e,i=s.nextNode()}},mentions(e=this.textarea){if(0===this.text.length)return{};let t={};const n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1);let s=n.nextNode(),o=0;while(s){for(let[e,n]of Object.entries(this.tags)){const i=new RegExp(`(?<i>${e})\\b`,"g");let a=s.textContent.matchAll(i);for(let e of a)this.tags[e.groups.i]&&(t[o+"."+e.index+"_"+e.groups.i]={el:s,pos:e.index,tag:Array.from(n),length:e.groups.i.length})}s=n.nextNode(),o++}return t},async formatMentionsForPublishing(e,t=this.textarea.cloneNode(!0)){let n=this.mentions(t);for(let o in n){let t=n[o],s=e.findIndex((([e,n])=>e===t.tag[0]&&n===t.tag[1]));if(-1===s){let n;"p"===t.tag[0]?n=await(0,at.l_)(t.tag[1]):"e"===t.tag[0]&&(n=await(0,at.wn)(t.tag[1],"mention")),e.push(n),s=e.length-1}let i=new Range;i.setStart(t.el,t.pos),i.setEnd(t.el,t.pos+t.length),this.insertText(`#[${s}]`,i)}t.style.maxHeight="0",this.postEntry.appendChild(t);let s=t.innerText;return t.remove(),s},async updateMentionsTags(){this.trigger++;let{start:e}=this.startEndOfRange();const t=/(?<t>[@&]{1})(?<p>[a-f0-9]{64})/g;this.text.toLowerCase().match(t)&&(this.mentionsUpdating=!0,await this.extractMentions(this.textarea,this.tags),"#text"===e.el.nodeName&&e.pos>e.el.length?this.setCaret(e.el,e.el.length):this.setCaret(e.el,e.pos),this.updateText(),this.mentionsUpdating=!1)},startEndOfRange(e=this.caretRange){return{start:{el:e.startContainer,pos:e.startOffset},end:{el:e.endContainer,pos:e.endOffset}}},insertText(e,t=this.textareaRange){let{start:n,end:s}=this.startEndOfRange(t),o=n.el.textContent.slice(0,n.pos)+e+s.el.textContent.slice(s.pos),i=s.el.nextSibling;while("#text"===(null===(a=i)||void 0===a?void 0:a.nodeName)){var a;o+=i.textContent;let e=i.nextSibling;i.remove(),i=e}if(t.isCollapsed||(t.deleteContents(),s.el!==n.el&&s.el.remove()),"#text"===n.el.nodeName)n.el.textContent=o,this.setCaret(n.el,n.pos+e.length);else{let t=document.createTextNode(o);n.el.insertBefore(t,n.el.firstChild),this.setCaret(t,e.length)}this.updateText()},insertEmoji(e){this.trigger++,this.insertText(e.native)},animateSendIcon(){let e=setInterval((()=>{if(!this.sending)return clearInterval(e),void(this.sendIconTranslation=0);this.sendIconTranslation+=3,this.sendIconTranslation>50&&(this.sendIconTranslation-=this.postEntryWidth+40)}),50)},closeTools(){this.toolSelected=""},toggleTool(e){this.updateText(),this.toolSelected===e?this.closeTools():this.toolSelected=e},reset(){this.closeTools(),this.text="",this.textarea.innerHTML="",this.readonlyTextarea.innerHTML="",this.readonlyHighlightTextarea.innerHTML="",this.tags=[],this.links=[],this.focusInput()},appendHashtags(e){for(let t of this.hashtags)e.find((([e,n])=>n===t))||e.push(["t",t.toLowerCase()])},appendLinks(e){for(let t of this.links)t.name?e+=`\n[${t.name}](${t.url})`:e+=`\n${t.url}`;return e},setCaret(e,t){const n="undefined"!==typeof window.getSelection;if(n&&e){const n=window.getSelection(),s=document.createRange();n.removeAllRanges(),s.selectNodeContents(e),s.collapse(!0),s.setStart(e,t),n.addRange(s),this.focusInput()}},addLink(e){this.links.push(e)},linkName(e){return e.name?`${e.name}: `:""},removeLink(e){this.links.splice(e,1)},textareaFocus(e){const t=this.placeholder;t.style.opacity=".5"},textareaBlur(e){const t=this.placeholder;t.style.opacity=".8"},colorText(e){let t=document.createElement("span");return t.innerHTML=e,t.style.color=kt("secondary"),t},updateReadonlyInput(){let e=this.textarea.innerHTML,t=Object.assign({},this.mentions());for(let n in t){let[t,s]=n.split("_");const o=new RegExp(`(?<i>${s})\\b`,"g");e=e.replaceAll(o,((e,t)=>this.colorText(s).outerHTML))}this.readonlyTextarea.innerHTML=e},updateReadonlyHightlightInput(){if(this.overCharLimit()){this.readonlyHighlightTextarea.innerHTML=this.textarea.innerHTML;let{el:e,pos:t}=this.charPos(this.charLimit,this.readonlyHighlightTextarea),n=e.length&&e.length>t,s=new Range;s.setStart(e,t),s.setEndAfter(this.readonlyHighlightTextarea.lastChild);let o=s.extractContents(),i=[].map.call(o.childNodes,((e,t)=>{if(0===t&&n)return"#text"===e.nodeName?e.textContent:e.innerHTML;let s=document.createElement("span");return s.style.background=kt("negative"),s.style.opacity=".6",s.innerHTML=e.innerHTML,e.innerHTML=s.outerHTML,e.outerHTML})).join(""),a=document.createElement("span");a.innerHTML=i,a.style.background=kt("negative"),a.style.opacity=".6";let r=new Range;r.setStart(e,t),r.collapse(!0),r.insertNode(a)}else this.readonlyHighlightTextarea.innerHTML=""},charPos(e,t=this.textarea){for(var n of t.childNodes)if(3===n.nodeType){if(n.length>=e)return{el:n,pos:e,char:-1};e-=n.length}else{let t=this.charPos(e,n);if(-1===t.char)return t;e=t.char}return{char:e}},extractUrls(e){const t=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,}))\.?)(?::\d{2,5})?(?:[/?#]\S*)?$/i;return e=e.replace(t,(e=>(this.addLink({url:e}),""))),e},charLeft(){return this.charLimit-this.text.length},overCharLimit(){return this.charLeft()<0},textValid(){return"repost"===this.replyMode||(!!this.links.length||!!this.text.length&&(!!this.messageMode||(!!this.longForm||!this.overCharLimit())))}}};var Mt=n(490),Ct=n(13246),_t=n(1389),qt=n(67236),St=n(11221),Tt=n(83302);const Bt=(0,W.Z)(xt,[["render",ot],["__scopeId","data-v-55bc36e0"]]),Rt=Bt;function Zt(e,t,n,o,a,r){const l=(0,s.up)("BaseButtonShowMore"),d=(0,s.up)("BasePost"),u=(0,s.up)("q-list");return(0,s.wg)(),(0,s.j4)(u,{ref:"thread",class:"no-padding"},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(r.filledEvents,((t,o)=>((0,s.wg)(),(0,s.iD)("div",{key:t.id+o,class:"no-padding"},["FILLER"===t.id?((0,s.wg)(),(0,s.j4)(l,{key:0,root:t.root},null,8,["root"])):"REPLIES"===t.id?((0,s.wg)(),(0,s.j4)(l,{key:1,root:t.root,"reply-count":t.replyCount},null,8,["root","reply-count"])):((0,s.wg)(),(0,s.j4)(d,{key:2,event:t,position:r.position(o),"reply-depth":n.replyDepth,onResized:r.resize,onAddEvent:r.addEvent,onClick:(0,i.iM)((n=>e.toEvent(t.id)),["stop"])},null,8,["event","position","reply-depth","onResized","onAddEvent","onClick"]))])))),128))])),_:1},512)}function Et(e,t,n,o,a,r){const l=(0,s.up)("q-separator"),d=(0,s.up)("q-btn"),u=(0,s.up)("q-btn-group");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(l,{color:"accent"}),(0,s.Wm)(u,{flat:"",spread:"",dense:"","text-color":"accent"},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{dense:"",flat:"",color:"accent",class:"text-weight-light",style:{"letter-spacing":".1rem"},onClick:(0,i.iM)(r.showMore,["stop"]),label:n.replyCount?n.replyCount+" replies":"show more"},null,8,["onClick","label"])])),_:1}),n.replyCount?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(l,{key:0,color:"accent"}))],64)}K()(xt,"components",{QItem:Mt.Z,QBtn:A.Z,QList:Ct.Z,QSpinnerOrbit:ke.Z,QBtnToggle:_t.Z,QIcon:F.Z,QTooltip:O.Z,QSeparator:H.Z,QTabPanels:Q.Z,QTabPanel:V.Z,QBtnGroup:qt.Z,QCheckbox:St.Z,QCircularProgress:Tt.Z});const $t={name:"BaseButtonShowMore",mixins:[R.Z],props:{root:{type:String,required:!0},replyCount:{type:Number,default:0}},methods:{showMore(){this.toEvent(this.root)}}},Pt=(0,W.Z)($t,[["render",Et]]),jt=Pt;K()($t,"components",{QSeparator:H.Z,QBtnGroup:qt.Z,QBtn:A.Z});const Dt={name:"BasePostThread",emits:["resized","add-event"],mixins:[R.Z],props:{events:{type:Array,required:!0},isAncestors:{type:Boolean,default:!1},replyDepth:{type:Number,default:0}},components:{BaseButtonShowMore:jt},data(){return{resizing:!1}},computed:{root(){return this.events[0].id},filledEvents(){if(!this.resizing||this.resizing){if(0===this.events.length)return[];var e=[this.events[0]];if(1===this.events.length)return this.pushShowMore(e);for(let t=1;t<this.events.length;t++){let n=this.events[t],s=this.events[t-1],o=n.interpolated.replies||[];o.length&&o[o.length-1]!==s.id&&e.push({id:"FILLER",root:s.id}),e.push(n)}return this.pushShowMore(e)}}},methods:{position(e){return this.isAncestors?1===this.filledEvents.length||0===e?"first":(this.filledEvents.length,"middle"):1===this.filledEvents.length?"single":0===e?"first":e===this.filledEvents.length-1?"last":"middle"},addEvent(e){console.log("basepostthread add-event",e),this.$emit("add-event",e)},resize(e){this.resizing=!this.resizing,this.$emit("resized")},pushShowMore(e){var t;let n=e[e.length-1];if(null!==(t=n.replies)&&void 0!==t&&t.length&&this.threadWidth()&&(this.replyDepth>=2||this.replyDepth>0&&this.threadWidth()<300)){let t=Object.assign({},n);t.replyCount=t.replies.length,t.replies=[],e.pop(),e.push(t),e.push({id:"REPLIES",root:t.id,replyCount:t.replyCount})}return e},threadWidth(){var e,t;return null===(e=this.$refs.thread)||void 0===e||null===(t=e.$el)||void 0===t?void 0:t.clientWidth}}},Wt=(0,W.Z)(Dt,[["render",Zt]]),zt=Wt;K()(Dt,"components",{QList:Ct.Z});const Nt={class:"text-h5 text-bold q-pt-md q-pb-sm q-px-sm"};function Lt(e,t,n,o,i,a){const r=(0,s.up)("q-separator");return(0,s.wg)(),(0,s.iD)("div",null,[(0,s._)("div",Nt,[(0,s.WI)(e.$slots,"default")]),e.separator?((0,s.wg)(),(0,s.j4)(r,{key:0,color:"accent",size:"1px"})):(0,s.kq)("",!0)])}const Ut=(0,s.aZ)({name:"BaseHeader",props:{separator:{type:Boolean,default:!0}}}),It=(0,W.Z)(Ut,[["render",Lt]]),Ft=It;K()(Ut,"components",{QSeparator:H.Z});const Ot=({app:e})=>{e.component("BasePost",X),e.component("BaseUserName",Se),e.component("BaseUserAvatar",$e),e.component("BaseUserCard",Pe.Z),e.component("BasePostEntry",Rt),e.component("BasePostThread",zt),e.component("BaseHeader",Ft)}},55635:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var s=n(37912);const o={Sunday:"Sunday",Monday:"Monday",Tuesday:"Tuesday",Wednesday:"Wednesday",Thursday:"Thursday",Friday:"Friday",Saturday:"Saturday",Sun:"Sun",Mon:"Mon",Tues:"Tues",Wed:"Wed",Thurs:"Thurs",Fri:"Fri",Sat:"Sat",second:"second",day:"day",January:"January",February:"February",March:"March",April:"April",May:"May",June:"June",July:"July",August:"August",September:"September",October:"October",November:"November",December:"December",Jan:"Jan",Feb:"Feb",Mar:"Mar",Apr:"Apr",Jun:"Jun",Jul:"Jul",Aug:"Aug",Sep:"Sep",Oct:"Oct",Nov:"Nov",Dec:"Dec",UTC:"UTC",now:"now",s:"s",m:"m",h:"h",post:"post",close:"close",setUser:"set user",read:"read",write:"write",reorderFollows:"reorder follows",cancel:"cancel",save:"save",searchProfiles:"search profiles",searchPosts:"search posts",feed:"feed",notifications:"notifications",messages:"messages",inbox:"inbox",settings:"settings",thread:"thread",event:"event",devTools:"dev tools",notFound:"Oops. Nothing here...",follows:"follows",followers:"followers",replies:"replies",profile:"profile",relays:"relays",users:"users",nip05Maintainer:"NIP05 maintainer",inactiveRelays:"inactive relays",preferences:"preferences",colors:"colors",font:"font",noFollows:"no follows",noFollowers:"no followers",noRelays:"no relays",dragDropReorder:"drag and drop to reorder"},i={en:o},a=({app:e})=>{const t=(0,s.o)({locale:"en",fallbackLocale:"en",globalInjection:!0,messages:i});e.use(t)}},34136:(e,t,n)=>{"use strict";n.d(t,{$d:()=>j,BT:()=>$,E1:()=>E,JH:()=>D,JL:()=>k,LB:()=>c,MD:()=>_,NL:()=>C,Ol:()=>z,Qs:()=>P,TE:()=>M,UD:()=>u,Uk:()=>f,Zd:()=>p,dq:()=>v,g2:()=>Z,h0:()=>R,ix:()=>B,jd:()=>d,mX:()=>x,mw:()=>y,nY:()=>W,oQ:()=>h,og:()=>N,pq:()=>T,sG:()=>S,sM:()=>q,t_:()=>w,uA:()=>g,w8:()=>b,yt:()=>m});n(40702),n(84641),n(83269);var s=n(6827),o=n(56391);const i=new Worker(new URL(n.p+n.u(426),n.b));(0,o.i)(i);const a={};function r(e,t){let n=e+" "+Math.random().toString().slice(-4);return i.postMessage({id:n,name:e,args:t}),new Promise(((e,t)=>{a[n]={resolve:e,reject:t}}))}function l(e,t,n){let s=e+" "+Math.random().toString().slice(-4);return a[s]=n,i.postMessage(JSON.stringify({id:s,name:e,args:t,stream:!0})),{update(...t){i.postMessage(JSON.stringify({id:s,name:e,args:t,stream:!0}))},cancel(){i.postMessage(JSON.stringify({id:s,cancel:!0})),delete a[s]}}}async function d(){return r("destroyStreams",[])}async function u(){return r("dbErase",[])}async function c(e){return r("dbSave",[e])}function p(e=Math.round(Date.now()/1e3),t=(()=>{})){return r("dbFeed",[e])}function h(e=Math.round(Date.now()/1e3),t=(()=>{})){return l("streamFeed",[e],t)}async function y(e){return r("dbChats",[e])}async function f(e,t,n=50,s=Math.round(Date.now()/1e3)){return r("dbMessages",[e,t,n,s])}async function m(e=(()=>{})){return l("streamMessages",[],e)}async function g(e){return r("dbEvent",[e])}async function v(e,t,n,s=(()=>{})){return l("dbStreamTagKind",[e,t,n],s)}async function b(e,t=(()=>{}),n=!1){return l("dbStreamEvent",[e,n],t)}async function w(e,t=50,n=Math.round(Date.now()/1e3)){return r("dbMentions",[e,t,n])}function k(e,t=(()=>{})){return l("streamMentions",[e],t)}async function x(e,t=Math.round(Date.now()/1e3)){return r("dbUnreadMentionsCount",[e,t])}async function M(e,t,n=Math.round(Date.now()/1e3)){return r("dbUnreadMessagesCount",[e,t,n])}async function C(e){return r("dbUserProfile",[e])}async function _(e){return r("dbUserFollows",[e])}async function q(e,t=Math.round(Date.now()/1e3),n=50){return r("dbUserNotes",[e,t,n])}function S(e,t=(()=>{})){return l("streamUser",[e],t)}function T(e,t=(()=>{})){return l("streamUserNotes",[e],t)}function B(e,t=(()=>{})){return l("streamUserProfile",[e],t)}function R(e,t=(()=>{})){return l("dbStreamUserFollows",[e],t)}function Z(e,t=(()=>{})){return l("dbStreamUserFollows",[e],t)}function E(e,t=(()=>{})){return l("dbStreamUserFollowers",[e],t)}function $(e,t=(()=>{})){return l("streamUserTags",[e],t)}async function P(e,t){return r("prune",[e,t])}async function j(e){return r("dbQuery",[e])}function D(e,t=0){return r("setRelays",[JSON.parse(JSON.stringify(e)),t])}function W(e,t){return r("publish",[JSON.parse(JSON.stringify(e)),t])}function z(){return r("activateSub",[])}function N(){return r("deactivateSub",[])}i.onmessage=e=>{var t,n;let{id:o,success:i,error:r,data:l,stream:d,type:u,notice:c}="string"===typeof e.data?JSON.parse(e.data):e.data;if(!u)if(c)s.Z.create({message:`Relay ${c.relay} says: ${c.message}`,color:"info"});else if(d)a[o]&&a[o](l);else{if(!i)return a[o].reject(new Error(r)),void delete a[o];null===(t=a[o])||void 0===t||null===(n=t.resolve)||void 0===n||n.call(t,l),delete a[o]}}},35176:(e,t,n)=>{"use strict";n.d(t,{d:()=>i});n(40702);var s=n(68048),o=n(67694);const i=(0,o.UA)();let a=null;i.onNotice(((e,t)=>{try{c.postMessage({type:"notice",notice:e,relay:t.url})}catch(n){console.log("error posting message to db from pool",n,"notice",e,"url ",t.url)}}));let r={},l={},d=!0,u=0,c=null,p=0,h=(0,s.Z)((e=>c.postMessage({type:"events",events:e})),1e3,{concatArrays:!0,promise:!0,maxWait:3e3});function y(e,t){d&&(p>=2e3&&(h.flush(),p=0),h([{event:e,relay:t}]),p++)}function f(e){}function m(){let e=Object.entries(l).map((([e,t])=>t)).reduce(((e,{type:t,value:n})=>{if("user"===t)return e[t]=[n],e;if("feed"===t)return(!e[t]||e[t]>=n)&&(e[t]=n),e;if("tag"===t){let t=n.tagType,s=n.tagValues;return e[`#${t}`]=(e[`#${t}`]||[]).concat(s),e}return e[t]=(e[t]||[]).concat(n),e}),{}),t=Object.entries(e).map((([e,t])=>{switch(e){case"user":return{authors:t,kinds:[0,1,2,3,4],since:u};case"userNotes":return{authors:t,kinds:[1]};case"userProfile":return{authors:t,kinds:[0]};case"userFollows":return{authors:t,kinds:[3]};case"userFollowers":return{"#p":t,kinds:[3]};case"userTags":return{"#p":t,kinds:[1,3,4],since:u};case"userMessages":return{authors:t,kinds:[4]};case"feed":return{since:t,kinds:[1,2]};case"event":return{ids:t};default:return{[e]:t,kinds:[0,1,2,3,4]}}}));return t}function g(e){delete l[e],d&&a&&(0===Object.keys(l).length?a.unsub():a.sub({filter:m()}))}const v={close(){self.close()},activateSub(){d=!0,a&&Object.keys(l).length&&a.sub({filter:m()})},deactivateSub(){d=!1,a&&a.unsub(),h.flush()},subUser(e){return{type:"user",value:e}},subUserNotes(e){return{type:"userNotes",value:e}},subUserProfile(e){return{type:"userProfile",value:e}},subUserFollows(e){return{type:"userFollows",value:e}},subUserFollowers(e){return{type:"userFollowers",value:e}},subUserTags(e){return{type:"userTags",value:e}},subTag(e,t){let n=Array.isArray(t)?t:[t];return{type:"tag",value:{tagType:e,tagValues:n}}},subFeed(e){return{type:"feed",value:e}},subEvent(e){let t=Array.isArray(e)?e:[e];return{type:"event",value:t}},setRelays(e,t){u=t;for(let n in e)r[n]?r[n].read===e[n].read&&r[n].write===e[n].write||(i.removeRelay(n),i.addRelay(n,e[n])):i.addRelay(n,e[n]);for(let n in r)e[n]||i.removeRelay(n),e[n]||console.log("removing relay",n);return r=e,r},publish(e,t){var n,s,o;if(t)return null===(n=i.relays[t])||void 0===n||null===(s=n.relay)||void 0===s||null===(o=s.publish)||void 0===o?void 0:o.call(s,e);i.publish(e,((t,n)=>{0===t&&console.log(`publish request sent to ${n}`),1===t&&console.log(`event published by ${n}`,e)}))}};function b(e){let{name:t,args:n,id:s,cancel:o,sub:r}="string"===typeof e.data?JSON.parse(e.data):e.data;if(e.ports.length&&"setPort"===t)c=e.ports[0];else if(!e.data.type)if(o)g(s);else if(r){if(l[s]=v[t](...n),!d)return;a?a.sub({filter:m()}):a=i.sub({cb:y,filter:m()},"main",f)}else{var u={id:s};let e;try{e=v[t](...n),u.success=!0,u.data=e}catch(p){u.success=!1,u.error=p.message}self.postMessage(JSON.stringify(u))}}self.onmessage=b},6549:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>Se});var s={};n.r(s),n.d(s,{NIP05Id:()=>v,avatar:()=>b,canEncryptDecrypt:()=>q,canSignEventsAutomatically:()=>_,contacts:()=>k,displayName:()=>g,hasMoreContacts:()=>x,hasName:()=>f,name:()=>m,namedProfiles:()=>y,profileDescription:()=>w,unreadChats:()=>M,unreadNotifications:()=>C});var o={};n.r(o),n.d(o,{addContactListToCache:()=>I,addProfileToCache:()=>L,addRelay:()=>E,addToNIP05VerificationCache:()=>U,follow:()=>W,haveReadMessage:()=>H,haveReadNotifications:()=>F,removeRelay:()=>$,reorderFollows:()=>N,saveRelays:()=>j,setFollowing:()=>D,setKeys:()=>R,setRelayOpt:()=>P,setRelays:()=>Z,setUnreadMessages:()=>A,setUnreadNotifications:()=>O,unfollow:()=>z});var i={};n.r(i),n.d(i,{addEvent:()=>de,cancelUseProfile:()=>ve,initKeys:()=>oe,launch:()=>ie,launchWithoutKey:()=>ae,publishContactList:()=>pe,recommendRelay:()=>ye,restartMainSubscription:()=>le,sendChatMessage:()=>ce,sendPost:()=>ue,setMetadata:()=>he,useNip05:()=>be,useProfile:()=>ge});var a=n(76058),r=(n(40702),n(63703));const l=()=>window.location.hostname.endsWith(".onion"),d=()=>{const e={"wss://rsslay.fiatjaf.com":{read:!0,write:!1},"wss://nostr-pub.wellorder.net":{read:!0,write:!0},"wss://expensive-relay.fiatjaf.com":{read:!0,write:!1}},t=[["wss://nostr.rocks",{read:!0,write:!0}],["wss://relayer.fiatjaf.com",{read:!0,write:!0}],["wss://nostr.onsats.org",{read:!0,write:!0}],["wss://nostr-relay.wlvs.space",{read:!0,write:!0}],["wss://nostr.bitcoiner.social",{read:!0,write:!0}]];for(let n=0;n<3;n++){let n=parseInt(Math.random()*t.length),[s,o]=t[n];e[s]=o,t.splice(n,1)}return e},u=()=>({"ws://jgqaglhautb4k6e6i2g34jakxiemqp6z4wynlirltuukgkft2xuglmqd.onion":{read:!0,write:!0},"ws://wagvwfrdrikrqzp7h3b5lwl6btyuttu7mqpeji35ljzq36ovzgjhsfqd.onion":{read:!0,write:!0}});function c(){const e=l()?u():d();return{keys:r.Z.getItem("keys")||{},relays:e,following:[],profilesCache:{},profilesCacheLRU:[],contactListCache:{},contactListCacheLRU:[],nip05VerificationCache:{},lastMessageRead:r.Z.getItem("lastMessageRead")||{},unreadMessages:{},lastNotificationRead:r.Z.getItem("lastNotificationRead")||0,unreadNotifications:0}}var p=n(61993),h=n.n(p);function y(e,t){return Object.entries(e.profilesCache).reduce(((e,[n,s])=>t.hasName(n)?[...e,{...s,pubkey:n}]:e),[])}function f(e){return t=>{let{name:n,nip05:s}=e.profilesCache[t]||{};return(n||s||"").length>0}}function m(e){return t=>{let{name:n}=e.profilesCache[t]||{};return n}}function g(e,t){return t=>{let{name:n,nip05:s}=e.profilesCache[t]||{};return s?s.startsWith("_@")?s.slice(2):s:n||t.slice(0,3)+"..."+t.slice(-4)}}function v(e){return t=>{let{nip05:n}=e.profilesCache[t]||{};return n}}function b(e){return t=>{let{picture:n="data:image/png;base64,"+new(h())(t,40).toString()}=e.profilesCache[t]||{};return n}}function w(e){return t=>{let{about:n=""}=e.profilesCache[t]||{};return n}}function k(e){return t=>e.contactListCache[t]}function x(e){return t=>{var n;return(null===(n=e.contactListCache[t])||void 0===n?void 0:n.length)>6}}function M(e){return delete e.unreadMessages[e.keys.pub],Object.values(e.unreadMessages).filter((e=>e)).length}function C(e){return e.unreadNotifications}function _(e){return Boolean(e.keys.priv||window.nostr)}function q(e){return Boolean(e.keys.priv||window.nostr&&window.nostr.nip04)}n(84641),n(83269),n(46727);var S=n(67694),T=n(50806),B=n(74961);function R(e,{mnemonic:t,priv:n,pub:s}={}){if(t||n||s||(t=(0,B.Ol)()),t){let e=(0,B.UH)(t);n=(0,B.ik)(e)}n&&(s=(0,S.$3)(n)),e.keys={priv:n,pub:s}}function Z(e,t){e.relays=t}function E(e,t){try{(0,T.O)(t),new URL(t)}catch(n){return}e.relays[t]={read:!0,write:!0}}function $(e,t){delete e.relays[t]}function P(e,{url:t,opt:n,value:s}){t in e.relays&&(e.relays[t][n]=s)}function j(e,t){e.relays=t}function D(e,t){e.following=t}function W(e,t){e.keys.pub!==t&&(e.following.includes(t)||e.following.push(t))}function z(e,t){let n=e.following.indexOf(t);n>=0&&e.following.splice(n,1)}function N(e,t){e.following=t}function L(e,{pubkey:t,name:n,about:s,picture:o,nip05:i}){if(t in e.profilesCache&&e.profilesCacheLRU.splice(e.profilesCacheLRU.indexOf(t),1),e.profilesCache[t]={name:n,about:s,picture:o,nip05:i},t===e.keys.pub||e.profilesCacheLRU.push(t),e.profilesCacheLRU.length>2500){let t=e.profilesCacheLRU.shift();delete e.profilesCache[t]}}function U(e,{identifier:t,pubkey:n}){e.nip05VerificationCache[t]={pubkey:n,when:Math.round(Date.now()/1e3)}}function I(e,t){t.pubkey in e.contactListCache&&e.contactListCacheLRU.splice(e.contactListCacheLRU.indexOf(t.pubkey),1);try{let n=t.tags.filter((([e,t])=>"p"===e&&t)).map((([e,t,n,s])=>({pubkey:t,relay:n,petname:s})));n.length&&(e.contactListCache[t.pubkey]=n)}catch(n){return}if(t.pubkey===e.keys.pub||e.contactListCacheLRU.push(t.pubkey),e.contactListCacheLRU.length>150){let t=e.contactListCacheLRU.shift();delete e.contactListCache[t]}}function F(e){e.lastNotificationRead=Math.round(Date.now()/1e3)}function O(e,t){e.unreadNotifications=t}function H(e,t){e.lastMessageRead[t]=Math.round(Date.now()/1e3)}function A(e,{peer:t,count:n}){e.unreadMessages[t]=n}var Q=n(55350),V=n(74827),J=n(6827),K=n(60899),Y=n(97286),X=n(35176);const G=X.d;async function ee(e){if(!window.nostr)return new Promise(((t,n)=>{Y.Z.create({class:"px-6 py-1 overflow-hidden",title:"Sign this event manually",message:`<pre class="font-mono">${JSON.stringify(e,null,2)}</pre>`,html:!0,prompt:{model:"",type:"text",isValid:e=>!!e.toLowerCase().match(/^[a-z0-9]{128}$/),attrs:{autocomplete:"off"},label:"Paste the signature here (as hex)"}}).onOk(t).onCancel((()=>n("Canceled."))).onDismiss((()=>n("Canceled.")))}));{let t=await window.nostr.signEvent(e);switch(typeof t){case"string":return t;case"object":return t.sig;default:throw new Error("Failed to sign with Nostr extension.")}}}var te=n(34136),ne=n(26041),se=n(22330);function oe(e,t){e.commit("setKeys",t),e.commit("haveReadNotifications")}async function ie(e){console.log("launch for ",e.state.keys.pub),e.state.keys.pub||(e.commit("setKeys"),e.commit("haveReadNotifications")),e.state.keys.priv?G.setPrivateKey(e.state.keys.priv):G.registerSigningFunction(ee);let t=await(0,te.MD)(e.state.keys.pub);var{relays:n,following:s}=e.state;if(t){try{n=JSON.parse(t.content)}catch(o){}s=t.tags.filter((([e,t])=>"p"===e&&t)).map((([e,t])=>t))}else n=r.Z.getItem("relays")||n,s=r.Z.getItem("following")||s;e.commit("setFollowing",s),e.commit("setRelays",n),e.dispatch("useProfile",{pubkey:e.state.keys.pub});for(let i of s)e.dispatch("useProfile",{pubkey:i});e.dispatch("restartMainSubscription")}async function ae(e){e.dispatch("restartMainSubscription")}let re={};async function le(e){var t,n;let s=(null===(t=r.Z.getItem("config"))||void 0===t||null===(n=t.timestamps)||void 0===n?void 0:n.lastUserMainSync)||0;await(0,te.JH)(e.state.relays,s-604800);let o="29f63b70d8961835b14062b195fc7d84fa810560b36dde0749e4bc084f0f8952",i=await(0,te.h0)(o);setTimeout((()=>{i.cancel()}),6e4),re.streamFeed||(re.streamFeed=await(0,te.oQ)(Math.round(Date.now()/1e3)-432e3)),e.state.keys.pub&&(setTimeout((()=>{(0,te.Qs)(e.state.keys.pub,[o,e.state.keys.pub].concat(e.state.following));let t=r.Z.getItem("config")||{};t.timestamps={lastUserMainSync:Math.round(Date.now()/1e3)},r.Z.set("config",t)}),18e4),e.state.following.length&&e.state.following.forEach((t=>e.dispatch("useProfile",{pubkey:t}))),re.streamUser||(re.streamUser=await(0,te.sG)(e.state.keys.pub,(async t=>{if(3===t.kind){let n=await(0,te.$d)(`\n          SELECT json_extract(event,'$.created_at') created_at\n          FROM nostr\n          WHERE json_extract(event,'$.kind') = 3 AND\n            json_extract(event,'$.pubkey') = '${e.state.keys.pub}'\n          LIMIT 1\n        `);if(n.length&&t.created_at<n[0].created_at)return;let s=JSON.parse(t.content);e.commit("setRelays",s);let o=t.tags.filter((([e,t])=>"p"===e&&t)).map((([e,t])=>t));e.commit("setFollowing",o),e.dispatch("restartMainSubscription")}else if(0===t.kind){let n=await(0,te.$d)(`\n          SELECT json_extract(event,'$.created_at') created_at\n          FROM nostr\n          WHERE json_extract(event,'$.kind') = 0 AND\n            json_extract(event,'$.pubkey') = '${e.state.keys.pub}'\n          LIMIT 1\n        `);if(n.length&&t.created_at<n[0].created_at)return;let s=(0,se.Wb)(t);e.commit("addProfileToCache",s)}}))))}async function de(e,{event:t,relay:n=null}){await(0,te.LB)(t,n)}async function ue(e,{message:t,tags:n=[],kind:s=1}){if(0!==t.length){n.push(["client","astral"]);try{const o={pubkey:e.state.keys.pub,created_at:Math.floor(Date.now()/1e3),kind:s,tags:n,content:t};let i=await G.publish(o);if(!i)throw new Error("could not create post for publishing");let a=await(0,te.nY)(i);if(!a)throw new Error("could not publish post");return console.log("sendPost",i,a),e.dispatch("addEvent",{event:i}),i}catch(o){return void J.Z.create({message:`could not publish post: ${o}`,color:"negative"})}}}async function ce(e,{now:t,pubkey:n,text:s,tags:o}){if(0===s.length)return;o.push(["client","astral"]);let i="???";try{var a,r,l;if(e.state.keys.priv)i=(0,Q.H)(e.state.keys.priv,n,s);else{if(await(null===(a=window)||void 0===a||null===(r=a.nostr)||void 0===r||null===(l=r.getPublicKey)||void 0===l?void 0:l.call(r))!==e.state.keys.pub)throw new Error("no private key available to encrypt!");i=await window.nostr.nip04.encrypt(n,s)}let d={pubkey:e.state.keys.pub,created_at:t,kind:4,tags:o.map((([e,t])=>[e,t])),content:i},u=await G.publish(d);if(!u)throw new Error("could not create message for publishing");let c=await(0,te.nY)(u);if(!c)throw new Error("could not publish message");return e.dispatch("addEvent",{event:u}),u}catch(d){return void J.Z.create({message:`could not publish message: ${d}`,color:"negative"})}}async function pe(e){let t=await(0,te.MD)(e.state.keys.pub);var n=(null===t||void 0===t?void 0:t.tags)||[];let s=[];await Promise.all(e.state.following.map((async e=>{let t=n.findIndex((([t,n])=>"p"===t&&n===e));t>=0?s.push(n[t]):s.push(await(0,ne.l_)(e))})));try{let t=await G.publish({pubkey:e.state.keys.pub,created_at:Math.floor(Date.now()/1e3),kind:3,tags:s,content:JSON.stringify(e.state.relays)});if(!t)throw new Error("could not create updated list of followed keys and relays");let n,o,i=await(0,te.nY)(t);if(!i)throw new Error("could not publish updated list of followed keys and relays");return n=JSON.parse(t.content),o=t.tags.filter((([e,t])=>"p"===e&&t)).map((([e,t])=>t)),e.commit("setFollowing",o),e.commit("setRelays",n),await e.dispatch("addEvent",{event:t}),J.Z.create({message:"updated and published list of followed keys and relays.",color:"positive"}),t}catch(o){return void J.Z.create({message:`could not publish updated list of followed keys and relays: ${o}`,color:"negative"})}}async function he(e,t){try{let n=await G.publish({pubkey:e.state.keys.pub,created_at:Math.floor(Date.now()/1e3),kind:0,tags:[],content:JSON.stringify(t)});if(!n)throw new Error("could not create updated profile event");let s=await(0,te.nY)(n);if(!s)throw new Error("could not publish update profile event");return e.dispatch("addEvent",{event:n}),e.commit("addProfileToCache",{pubkey:e.state.keys.pub,...t}),J.Z.create({message:"updated and published profile",color:"positive"}),n}catch(n){return void J.Z.create({message:`could not publish updated profile: ${n}`,color:"negative"})}}async function ye(e,t){try{let n=await G.publish({pubkey:e.state.keys.pub,created_at:Math.round(Date.now()/1e3),kind:2,tags:[],content:t});if(!n)throw new Error("could not create recommend relay event");let s=await(0,te.nY)(n);if(!s)throw new Error("could not publish recommend relay event");return e.dispatch("addEvent",{event:n}),n}catch(n){return void J.Z.create({message:`could not publish recommend relay event: ${n}`,color:"negative"})}}const fe=(0,K.Z)((async(e,t)=>{re.streamUserProfile?re.streamUserProfile.update(t):re.streamUserProfile=await(0,te.ix)(t,(async t=>{if(t.pubkey in e.state.profilesCache)return;let n=(0,se.Wb)(t);e.commit("addProfileToCache",n),e.dispatch("useNip05",{metadata:n})}))}),100);let me={};async function ge(e,{pubkey:t}){if(t in e.state.profilesCache)e.commit("addProfileToCache",{pubkey:t,...e.state.profilesCache[t]});else{let n=await(0,te.NL)(t);if(n){let t=(0,se.Wb)(n);e.dispatch("useNip05",{metadata:t})}}me[t]=me[t]||0,me[t]++,1===me[t]&&fe(e,Object.keys(me))}async function ve(e,{pubkey:t}){me[t]&&(me[t]--,0===me[t]&&(delete me[t],fe(e,Object.keys(me))))}async function be(e,{metadata:t}){if(""===t.nip05&&delete t.nip05,t.nip05){let n=e.state.nip05VerificationCache[t.nip05];if(n&&n.when>Date.now()/1e3-3600)n.pubkey!==t.pubkey&&delete t.nip05;else{let n=await(0,V.x)(t.nip05);e.commit("addToNIP05VerificationCache",{pubkey:n,identifier:t.nip05}),t.pubkey!==n&&delete t.nip05}}e.commit("addProfileToCache",t)}function we(e){e.subscribe((({type:e,payload:t},n)=>{switch(e){case"setKeys":r.Z.set("keys",n.keys);break;case"haveReadNotifications":r.Z.set("lastNotificationRead",n.lastNotificationRead);break;case"haveReadMessage":r.Z.set("lastMessageRead",n.lastMessageRead);break}}))}function ke(e){e.subscribe((({type:t,payload:n},s)=>{switch(t){case"addRelay":case"removeRelay":case"setRelayOpt":case"saveRelays":case"follow":case"unfollow":case"reorderFollows":e.dispatch("publishContactList");break}}))}const xe=(0,K.Z)(((e,t)=>{G.addRelay(t)}),3e3),Me=(0,K.Z)(((e,t)=>{G.removeRelay(t)}),3e3),Ce=(0,K.Z)(((e,t,n)=>{G.removeRelay(t),G.addRelay(t,n),e.dispatch("restartMainSubscription")}),3e3);function _e(e){e.subscribe((({type:t,payload:n},s)=>{switch(t){case"addRelay":xe(e,n);break;case"removeRelay":Me(e,n);break;case"setRelayOpt":Ce(e,n.url,s.relays[n.url]);break;case"saveRelays":case"follow":case"unfollow":e.dispatch("restartMainSubscription");break}}))}function qe(e){const t=async()=>{e.commit("setUnreadNotifications",await(0,te.mX)(e.state.keys.pub,e.state.lastNotificationRead))},n=async t=>{e.commit("setUnreadMessages",{peer:t,count:await(0,te.TE)(e.state.keys.pub,t,e.state.lastMessageRead[t]||0)})};let s=null;const o=()=>{if(e.state.keys.pub)s&&s.cancel(),s=(0,te.BT)(e.state.keys.pub,(e=>{1===e.kind?t():4===e.kind&&n(e.pubkey)}));else{let o=setInterval((()=>{e.state.keys.pub&&!s&&((0,te.BT)("p",e.state.keys.pub,(e=>{1===e.kind?t():4===e.kind&&n(e.pubkey)})),clearInterval(o))}),2e3)}t(),(0,te.mw)(e.state.keys.pub).then((e=>{e.forEach((e=>{n(e.peer)}))}))};e.subscribeAction((({type:e,payload:t},n)=>{switch(e){case"restartMainSubscription":o();break}})),e.subscribe((({type:e,payload:s},o)=>{switch(e){case"haveReadNotifications":t();break;case"haveReadMessage":n(s);break}}))}const Se=(0,a.MT)({state:c,getters:s,mutations:o,actions:i,plugins:[we,ke,_e,qe]})},22330:(e,t,n)=>{"use strict";n.d(t,{CX:()=>s,Wb:()=>o,nf:()=>i});n(40702),n(46727);function s(e){return{id:e.id,pubkey:e.pubkey,created_at:e.created_at,kind:e.kind,tags:e.tags,content:e.content,sig:e.sig}}function o(e){try{let t=JSON.parse(e.content);return t.pubkey=e.pubkey,t}catch(t){return console.log("metadataFromEvent error",t),{}}}function i(e){if(e.tags.filter((([e,t])=>!t||t.includes(" "))).length)return!1;try{return JSON.parse(e.content),!1}catch(t){}return!0}},26041:(e,t,n)=>{"use strict";n.d(t,{OV:()=>o,aR:()=>i,l_:()=>a,wn:()=>r});n(40702);var s=n(34136);function o(e){return e?e.slice(0,5)+"…"+e.slice(-5):""}function i(e,t,n){for(let s=0;s<e.length;s++){let o=e[s];if(n(o,t))return void e.splice(s,0,t)}e.push(t)}async function a(e){var t=["p",e];let n=await(0,s.NL)(e);if(n&&n.seen_on&&n.seen_on.length){let e=n.seen_on[Math.floor(Math.random()*n.seen_on.length)];t.push(e)}return t}async function r(e,...t){let n=await(0,s.uA)(e);if(n&&n.seen_on&&n.seen_on.length){let e=n.seen_on[Math.floor(Math.random()*n.seen_on.length)];return["e",n.id,e,...t]}return["e",e,"",...t]}},18933:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});n(40702),n(46727),n(18964);var s=n(56366),o=n.n(s),i=n(26041),a=n(4376),r=n(34136),l=n(55350);const{formatDate:d}=a.ZP;function u(e,t){return d(e,t,{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tues","Wed","Thurs","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]})}function c(e,t=!1){let n=new Date(1e3*e),s=new Date(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate()),o=Date.now();return o-s.getTime()<31536e6&&o>s.getTime()?u(s,t?"ddd D MMMM":"D MMMM"):u(s,t?"ddd D MMMM YYYY":"D MMMM YYYY")}const p={methods:{getLocation(){return location},json(e){return JSON.stringify(e,null,2)},log(e){return console.log(e)},toProfile(e){this.$router.push("/"+e)},toEvent(e){window.getSelection().toString().length||this.$router.push("/event/"+e)},shorten:i.OV,niceDateUTC(e){let t=Math.floor(Date.now()/1e3);if(e>t)return c(e);if(e===t)return this.$t("now");let n=t-e;if(n<60)return`${n}${this.$t("s")}`;let s=Math.floor(n/60);if(s<60)return`${s}${this.$t("m")}`;let o=Math.floor(s/60);return o<24?`${o}${this.$t("h")}`:c(e)},dateUTC(e){return c(e,!0)},timeUTC(e){let t=new Date(1e3*e);return`${String(t.getUTCHours()).padStart(2,"0")}:${String(t.getUTCMinutes()).padStart(2,"0")} ${this.$t("UTC")}`},interpolateMentions(e,t){const n={profiles:[],replyEvents:[],mentionEvents:[]};if(e=String(e).trim(),""===e)return{text:e,replyEvents:[],mentionEvents:t.filter((([e,t])=>"e"===e&&t)).map((([e,t])=>t))};const s=(s,o)=>{if(t.length-1<Number(o)||t[Number(o)].length<2||!["e","p"].includes(t[Number(o)][0]))return s;if("e"===t[Number(o)][0]){const a=t[Number(o)][1];return n.mentionEvents.push(a),s.length===e.length?"":`[&${(0,i.OV)(a)}](/event/${a})`}if("p"===t[Number(o)][0]){const e=t[Number(o)][1],n=this.$store.getters.displayName(e);return`[@${n}](/${e})`}},o=(e,t)=>`[${e}](/hashtag/${t})`;let a=e.replace(/#\[(\d+)\]/g,s),r=a.replace(/#([\w]{1,63})/g,o),l=t.findIndex((([e,t,n,s])=>"e"===e&&t&&"root"===s));if(l>=0){let[e,s]=t[l];!n.mentionEvents.includes(s)&&n.replyEvents.length<2&&n.replyEvents.push(s);let o=t.find((([e,t,n,s])=>"e"===e&&t&&"root"===s));if(o>=0){let[e,s]=t[o];!n.mentionEvents.includes(s)&&n.replyEvents.length<2&&n.replyEvents.push(s)}}return t.filter((([e,t])=>"e"===e&&t)).forEach((([e,t],s)=>{n.mentionEvents.includes(t)||n.replyEvents.includes(t)||(n.replyEvents.length<2?n.replyEvents.push(t):n.mentionEvents.push(t))})),{text:r,replyEvents:n.replyEvents,mentionEvents:n.mentionEvents}},interpolateEventMentions(e){Array.isArray(e)||(e=[e]),e.forEach((e=>{e.interpolated||(e.interpolated=this.interpolateMentions(e.content,e.tags||[]))}))},interpolateMessageMentions(e){Array.isArray(e)||(e=[e]),e.forEach((e=>{e.interpolated||(e.interpolated=this.interpolateMentions(e.text,e.tags))}))},createMentionsProvider(e){const t=new(o())({menuContainer:document.getElementById("tribute-wrapper"),positionMenu:!1,selectTemplate:e=>`@${e.original.value.pubkey}`,menuItemTemplate:e=>`\n            <div class="flex row no-wrap items-center" style="gap: .2rem; width: 100%;">\n              <div style="border-radius: 10px">\n                <img src=${this.$store.getters.avatar(e.original.value.pubkey)} crossorigin style="object-fit: cover; height: 1.5rem; width: 1.5rem;"/>\n              </div>\n                <div class="text-bold">${e.string}</div>\n              ${e.original.value.nip05?'<i class="notranslate material-icons text-accent mr-1 -ml-1" aria-hidden="true" role="presentation">verified</i>':""}\n                <div class="text-secondary text-caption">${(0,i.OV)(e.original.value.pubkey)}</div>\n              </div>\n            `,values:(e,t)=>{t(this.$store.getters.namedProfiles.map((e=>({key:this.$store.getters.displayName(e.pubkey),value:e}))))},noMatchTemplate:()=>{}});return{attach:e=>t.attach(e),detach:e=>t.detach(e)}},async processTaggedEvents(e,t){if(!Array.isArray(t))throw new Error("no array supplied");e.splice(10);let n={};for(let s of e)n[s]=await(0,r.w8)(s,(async o=>{this.$store.dispatch("useProfile",{pubkey:o.pubkey}),1===o.kind||2===o.kind?this.interpolateEventMentions(o):4===o.kind&&(o.text=await this.getPlaintext(o),this.interpolateMessageMentions(o)),Array.isArray(t)?t.push(o):console.log("processTaggedEvents events not array",e,o,t),n[s].cancel()}))},async getPlaintext(e){if(e.tags.find((([e,t])=>"p"===e&&t===this.$store.state.keys.pub)))return await this.decrypt(e.pubkey,e.content);if(e.pubkey===this.$store.state.keys.pub){let[t,n]=e.tags.find((([e])=>"p"===e));return await this.decrypt(n,e.content)}},async decrypt(e,t){try{var n,s,o;if(this.$store.state.keys.priv)return(0,l.p)(this.$store.state.keys.priv,e,t);if(await(null===(n=window)||void 0===n||null===(s=n.nostr)||void 0===s||null===(o=s.getPublicKey)||void 0===o?void 0:o.call(s))===this.$store.state.keys.pub)return await window.nostr.nip04.decrypt(e,t);throw new Error("no private key available to decrypt!")}catch(i){return"???"}}}}},68067:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var s=n(59835),o=n(86970);function i(e,t,n,i,a,r){const l=(0,s.up)("q-tooltip"),d=(0,s.up)("q-btn");return e.buttonText?((0,s.wg)(),(0,s.j4)(d,{key:0,icon:"content_copy",unelevated:"",clickable:"",onClick:e.copy,class:(0,o.C_)([""+e.buttonClass,"button-copy"]),size:e.buttonSize,dense:"",label:e.verbose?"copy":"",align:"left"},{default:(0,s.w5)((()=>[e.tooltipText?((0,s.wg)(),(0,s.j4)(l,{key:0},{default:(0,s.w5)((()=>[(0,s.Uk)((0,o.zw)(e.tooltipText),1)])),_:1})):(0,s.kq)("",!0)])),_:1},8,["onClick","class","size","label"])):(0,s.kq)("",!0)}const a=(0,s.aZ)({name:"BaseButtonCopy",props:{buttonText:{type:String,required:!0},buttonClass:{type:String,required:!1,default:""},buttonSize:{type:String,required:!1,default:"sm"},verbose:{type:Boolean,default:!1},tooltipText:{type:String,required:!1,default:""},element:{type:Object,default:null}},methods:{copy(){let e=this.copyText(this.buttonText);console.log(e),navigator.clipboard.writeText(e)},copyText(e){var t,n;let s=null===(t=this.element)||void 0===t||null===(n=t.getSelection())||void 0===n?void 0:n.toString();return s||e}}});var r=n(11639),l=n(24455),d=n(46858),u=n(69984),c=n.n(u);const p=(0,r.Z)(a,[["render",i]]),h=p;c()(a,"components",{QBtn:l.Z,QTooltip:d.Z})},51607:(e,t,n)=>{"use strict";n.d(t,{Z:()=>R});var s=n(59835),o=n(61957),i=n(86970);const a={class:"flex row justify-end"},r={class:"overflow-auto"},l=(0,s.Uk)(" metadata ");function d(e,t,n,d,u,c){const p=(0,s.up)("q-btn"),h=(0,s.up)("BaseRawEvent"),y=(0,s.up)("q-card"),f=(0,s.up)("q-dialog"),m=(0,s.up)("q-tooltip"),g=(0,s.Q2)("close-popup");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(f,{modelValue:e.metadataDialog,"onUpdate:modelValue":t[0]||(t[0]=t=>e.metadataDialog=t),onBeforeHide:t[1]||(t[1]=t=>e.$emit("hide"))},{default:(0,s.w5)((()=>[(0,s.Wm)(y,{class:"flex column no-wrap",style:{"max-height":"90%"}},{default:(0,s.w5)((()=>[(0,s._)("div",a,[(0,s.wy)((0,s.Wm)(p,{icon:"close",flat:"",dense:""},null,512),[[g]])]),(0,s._)("div",r,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.events,(e=>((0,s.wg)(),(0,s.j4)(h,{key:e.id,event:e},null,8,["event"])))),128))])])),_:1})])),_:1},8,["modelValue"]),(0,s.Wm)(p,{icon:"info",unelevated:"",clickable:"",onClick:t[2]||(t[2]=(0,o.iM)((t=>e.toggleMetadataDialog()),["stop"])),class:(0,i.C_)([""+e.buttonClass,"button-info"]),size:e.buttonSize,label:e.verbose?"info":"",dense:"",align:"left"},{default:(0,s.w5)((()=>[e.verbose?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(m,{key:0},{default:(0,s.w5)((()=>[l])),_:1}))])),_:1},8,["class","size","label"])],64)}const u={class:"text-subtitle1"},c=(0,s.Uk)(" raw event data ");function p(e,t,n,o,a,r){const l=(0,s.up)("BaseButtonCopy"),d=(0,s.up)("q-card-section"),p=(0,s.up)("q-card");return(0,s.wg)(),(0,s.j4)(p,null,{default:(0,s.w5)((()=>[(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s._)("div",u,[c,(0,s.Wm)(l,{"button-text":e.json(r.cleaned)},null,8,["button-text"])]),(0,s._)("pre",null,(0,i.zw)(e.json(r.cleaned)),1)])),_:1})])),_:1})}var h=n(18933),y=n(22330),f=n(68067);const m={name:"BaseRawEvent",mixins:[h.Z],props:{event:{type:Object,required:!0}},components:{BaseButtonCopy:f.Z},computed:{cleaned(){return Array.isArray(this.event)?this.event.map(y.CX):(0,y.CX)(this.event)}}};var g=n(11639),v=n(44458),b=n(63190),w=n(69984),k=n.n(w);const x=(0,g.Z)(m,[["render",p]]),M=x;k()(m,"components",{QCard:v.Z,QCardSection:b.Z});const C=(0,s.aZ)({name:"BaseButtonInfo",emits:["dialog","hide"],components:{BaseRawEvent:M},data(){return{metadataDialog:!1}},props:{event:{type:Object,required:!0},buttonClass:{type:String,required:!1,default:""},buttonSize:{type:String,required:!1,default:"sm"},verbose:{type:Boolean,default:!1}},computed:{events(){return Array.isArray(this.event)?this.event:[this.event]}},methods:{toggleMetadataDialog(){this.metadataDialog=!this.metadataDialog,this.$emit("dialog",this.metadataDialog)}}});var _=n(87743),q=n(24455),S=n(46858),T=n(62146);const B=(0,g.Z)(C,[["render",d]]),R=B;k()(C,"components",{QDialog:_.Z,QCard:v.Z,QBtn:q.Z,QTooltip:S.Z}),k()(C,"directives",{ClosePopup:T.Z})},73270:(e,t,n)=>{"use strict";n.d(t,{Z:()=>w});var s=n(59835),o=n(86970);const i={class:"flex row justify-end"},a={class:"overflow-auto"},r=(0,s.Uk)(" seen on relays ");function l(e,t,n,l,d,u){const c=(0,s.up)("q-btn"),p=(0,s.up)("BaseRelayList"),h=(0,s.up)("q-card"),y=(0,s.up)("q-dialog"),f=(0,s.up)("q-tooltip"),m=(0,s.Q2)("close-popup");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(y,{modelValue:e.relayListDialog,"onUpdate:modelValue":t[0]||(t[0]=t=>e.relayListDialog=t),onBeforeHide:t[1]||(t[1]=t=>e.$emit("hide"))},{default:(0,s.w5)((()=>[(0,s.Wm)(h,null,{default:(0,s.w5)((()=>[(0,s._)("div",i,[(0,s.wy)((0,s.Wm)(c,{icon:"close",flat:"",dense:""},null,512),[[m]])]),(0,s._)("div",a,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.events,(e=>((0,s.wg)(),(0,s.j4)(p,{key:e.id,event:e},null,8,["event"])))),128))])])),_:1})])),_:1},8,["modelValue"]),(0,s.Wm)(c,{icon:"sync_alt",unelevated:"",clickable:"",onClick:e.toggleRelayListDialog,class:(0,o.C_)([""+e.buttonClass,"button-relays"]),size:e.buttonSize,label:e.verbose?"relays":"",dense:"",align:"left"},{default:(0,s.w5)((()=>[e.verbose?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(f,{key:0},{default:(0,s.w5)((()=>[r])),_:1}))])),_:1},8,["onClick","class","size","label"])],64)}var d=n(52787);const u=(0,s.aZ)({name:"BaseButtonRelays",emits:["dialog","hide"],components:{BaseRelayList:d.Z},data(){return{relayListDialog:!1}},props:{event:{type:Object,required:!0},buttonClass:{type:String,required:!1,default:""},buttonSize:{type:String,required:!1,default:"sm"},verbose:{type:Boolean,default:!1}},computed:{events(){return Array.isArray(this.event)?this.event:[this.event]}},methods:{toggleRelayListDialog(){this.relayListDialog=!this.relayListDialog,this.$emit("dialog",this.relayListDialog)}}});var c=n(11639),p=n(87743),h=n(44458),y=n(24455),f=n(46858),m=n(62146),g=n(69984),v=n.n(g);const b=(0,c.Z)(u,[["render",l]]),w=b;v()(u,"components",{QDialog:p.Z,QCard:h.Z,QBtn:y.Z,QTooltip:f.Z}),v()(u,"directives",{ClosePopup:m.Z})},63602:(e,t,n)=>{"use strict";n.d(t,{Z:()=>R});n(40702);var s=n(59835),o=n(86970),i=n(61957);const a={ref:"src",class:"hidden break-word-wrap"},r={ref:"append",class:"hidden break-word-wrap"},l=["innerHTML"];function d(e,t,n,d,u,c){const p=(0,s.up)("q-btn");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s._)("div",a,[(0,s.WI)(e.$slots,"default")],512),(0,s._)("div",r,[(0,s.WI)(e.$slots,"append")],512),(0,s._)("div",{innerHTML:u.html,class:(0,o.C_)(["break-word-wrap dynamic-content",n.longForm?"long-form":""]),onClick:t[0]||(t[0]=(...e)=>c.handleClicks&&c.handleClicks(...e))},null,10,l),n.longForm?((0,s.wg)(),(0,s.j4)(p,{key:0,id:"long-form-button",dense:"",outline:"",rounded:"",color:"accent",class:"text-weight-light q-ma-sm justify-between",style:{"letter-spacing":".1rem","justify-content":"space-between"},label:"show full post",onClick:(0,i.iM)(c.expand,["stop"])},null,8,["onClick"])):(0,s.kq)("",!0)],64)}n(18964),n(84641),n(83269);var u=n(27678),c=n.n(u),p=n(51994),h=n.n(p),y=n(64879),f=n.n(y),m=n(77984),g=n.n(m),v=n(89105),b=n.n(v),w=n(30651),k=n.n(w),x=n(18933);const M=c()({html:!1,breaks:!0,linkify:!0});M.use(h()).use(f()).use(g()).use(b()).use(k()).use((e=>{e.core.ruler.before("normalize","auto-imager",(e=>{e.src=e.src.replace(/https?:[^ \n]+/g,(e=>{if(e){let t=e.split("?")[0];if(t.endsWith(".gif")||t.endsWith(".png")||t.endsWith(".jpeg")||t.endsWith(".jpg")||t.endsWith(".mp4")||t.endsWith(".webm")||t.endsWith(".ogg"))return`![](${e})`}return e}))})),e.renderer.rules.image=(e,t)=>{let n=e[t].attrs[[e[t].attrIndex("src")]][1],s=n.split("?")[0];return s.endsWith(".gif")||s.endsWith(".png")||s.endsWith(".jpeg")||s.endsWith(".jpg")?`<img src="${n}" crossorigin async style="max-width: 90%; max-height: 50vh;">`:s.endsWith(".mp4")||s.endsWith(".webm")||s.endsWith(".ogg")?`<video src="${n}" controls crossorigin async style="max-width: 90%; max-height: 50vh;"></video>`:void 0};var t=e.renderer.rules.link_open||function(e,t,n,s,o){return o.renderToken(e,t,n)};e.renderer.rules.link_open=function(e,n,s,o,i){var a=e[n],r=a.attrIndex("target"),l=a.attrIndex("href"),d=/^https?:\/\//;return d.test(a.attrs[l][1])&&(r<0?e[n].attrPush(["target","_blank"]):e[n].attrs[r][1]="_blank"),t(e,n,s,o,i)}})),M.linkify.tlds(["onion","eth"],!0).add("bitcoin:",null).add("lightning:",null).add("http:",{validate(e,t,n){var s=e.slice(t);return n.re.http||(n.re.http=new RegExp("^\\/\\/"+n.re.src_auth+n.re.src_host_port_strict+n.re.src_path,"i")),n.re.http.test(s)?s.match(n.re.http)[0].length:0},normalize(e,t){if(t.__text_cache__.length<150||e.text<23)return;let n=new URL(e.url),s=n.host;if((n.pathname+n.search+n.hash).length>10){let t=e.text.slice(-7);"/"===t[0]&&(t=t.slice(1)),s+=`/…/${t}`}e.text=s}}).set({fuzzyEmail:!1});const C={name:"BaseMarkdown",mixins:[x.Z],emits:["expand"],data(){return{html:"",links:[]}},props:{longForm:{type:Boolean,default:!1}},mounted(){this.render()},updated(){this.render()},methods:{render(){this.html=M.render(this.$refs.src.innerHTML)+this.$refs.append.innerHTML},handleClicks(e){let{target:t}=e;if(t&&t.matches(".dynamic-content a:not([href*='://'])")&&t.href){const{altKey:n,ctrlKey:s,metaKey:o,shiftKey:i,button:a,defaultPrevented:r}=e;if(o||n||s||i)return;if(r)return;if(void 0!==a&&0!==a)return;if(t&&t.getAttribute){const e=t.getAttribute("target");if(/\b_blank\b/i.test(e))return}const l=new URL(t.href),d=l.pathname;window.location.pathname!==d&&e.preventDefault&&(e.preventDefault(),e.stopPropagation(),this.$router.push(d))}else t&&t.matches(".dynamic-content a[href*='://']")&&t.href&&e.stopPropagation()},expand(e){this.$emit("expand")}}};var _=n(11639),q=n(24455),S=n(69984),T=n.n(S);const B=(0,_.Z)(C,[["render",d]]),R=B;T()(C,"components",{QBtn:q.Z})},3475:(e,t,n)=>{"use strict";n.d(t,{Z:()=>R});var s=n(59835),o=n(86970),i=n(61957);const a={key:0,class:"text-accent timestamp"},r={class:"flex column message-bubbles"},l={key:0,class:"flex column text-left full-width q-pb-xs embeded-message",style:{display:"block"},clickable:!1},d={key:0,class:"reposts"};function u(e,t,n,u,c,p){const h=(0,s.up)("BasePost"),y=(0,s.up)("BaseMessage",!0),f=(0,s.up)("BaseUserName"),m=(0,s.up)("BaseMarkdown"),g=(0,s.up)("BaseButtonReply"),v=(0,s.up)("BaseButtonCopy"),b=(0,s.up)("BaseButtonInfo"),w=(0,s.up)("BaseButtonRelays"),k=(0,s.up)("q-list"),x=(0,s.up)("q-menu"),M=(0,s.Q2)("close-popup");return(0,s.wg)(),(0,s.iD)("div",{class:(0,o.C_)(["relative-position flex column",p.sent?"message-sent":"message-received"]),onClick:t[3]||(t[3]=(0,i.iM)((()=>{}),["stop"]))},[n.isEmbeded?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",a,(0,o.zw)(e.timeUTC(n.event.created_at)),1)),(0,s._)("div",r,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(p.sequence,((a,r)=>((0,s.wg)(),(0,s.iD)("div",{key:r,class:(0,o.C_)(["message-bubble",(0===r||1===p.sequence.length?" first-message":"")+(r===p.sequence.length-1?" last-message":"")])},[!n.isEmbeded&&c.taggedEvents[a.id]&&c.render?((0,s.wg)(),(0,s.iD)("div",l,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(c.taggedEvents[a.id],(n=>((0,s.wg)(),(0,s.iD)("div",{key:n.id+"_"+c.taggedEvents[a.id].length+"_"+c.render},[1===n.kind||2===n.kind?((0,s.wg)(),(0,s.iD)("div",d,[(0,s.Wm)(h,{event:n,"manual-focus":!1,"is-embeded":!0,onContextmenuCapture:(0,i.iM)((t=>e.toEvent(n.id)),["stop"])},null,8,["event","onContextmenuCapture"])])):4===n.kind?((0,s.wg)(),(0,s.j4)(y,{key:1,event:n,class:"no-padding no-margin","is-embeded":!0,clickable:"",onMounted:t[0]||(t[0]=t=>e.$emit("mounted")),onClickCapture:t[1]||(t[1]=(0,i.iM)((()=>{}),["prevent","stop"]))},null,8,["event"])):(0,s.kq)("",!0)])))),128))])):(0,s.kq)("",!0),n.isEmbeded?((0,s.wg)(),(0,s.iD)("div",{key:1,class:(0,o.C_)(["flex row justify-between q-gutter-md",p.sent?"reverse":""])},[(0,s.Wm)(f,{pubkey:a.pubkey,fallback:!0},null,8,["pubkey"]),(0,s._)("span",null,(0,o.zw)(e.niceDateUTC(n.event.created_at)),1)],2)):(0,s.kq)("",!0),(0,s.Wm)(m,null,{default:(0,s.w5)((()=>[(0,s.Uk)((0,o.zw)(a.interpolated.text),1)])),_:2},1024),n.isEmbeded?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(x,{key:2,modelValue:c.contextMenus[r],"onUpdate:modelValue":e=>c.contextMenus[r]=e,"touch-position":"","context-menu":"",persistent:c.persistentMenu,onClick:t[2]||(t[2]=(0,i.iM)((()=>{}),["stop"]))},{default:(0,s.w5)((()=>[(0,s.Wm)(k,{dense:"",class:"flex column q-gutter-xs q-pa-xs"},{default:(0,s.w5)((()=>[(0,s.wy)(((0,s.wg)(),(0,s.iD)("div",null,[(0,s.Wm)(g,{"button-class":"text-accent full-width justify-start",verbose:!0,onReply:e=>p.reply(a)},null,8,["onReply"])])),[[M]]),(0,s.wy)(((0,s.wg)(),(0,s.iD)("div",null,[(0,s.Wm)(v,{"button-class":"text-accent full-width justify-start","button-text":a.interpolated.text,verbose:!0},null,8,["button-text"])])),[[M]]),(0,s._)("div",null,[(0,s.Wm)(b,{"button-class":"text-accent full-width justify-start",event:a,verbose:!0,onHide:p.hideMenu,onDialog:p.togglePersistentMenu},null,8,["event","onHide","onDialog"])]),(0,s._)("div",null,[(0,s.Wm)(w,{"button-class":"text-accent full-width justify-start",event:a,verbose:!0,onHide:p.hideMenu,onDialog:p.togglePersistentMenu},null,8,["event","onHide","onDialog"])])])),_:2},1024)])),_:2},1032,["modelValue","onUpdate:modelValue","persistent"]))],2)))),128))])],2)}n(40702);var c=n(19302),p=n(18933),h=n(73270),y=n(51607),f=n(68067);function m(e,t,n,i,a,r){const l=(0,s.up)("q-btn");return(0,s.wg)(),(0,s.j4)(l,{icon:"reply",unelevated:"",clickable:"",onClick:t[0]||(t[0]=t=>e.$emit("reply")),class:(0,o.C_)([""+e.buttonClass,"button-reply"]),size:e.buttonSize,dense:"",label:e.verbose?"reply":"",align:"left"},null,8,["class","size","label"])}const g=(0,s.aZ)({name:"BaseButtonReply",emits:["reply"],props:{buttonClass:{type:String,required:!1,default:""},buttonSize:{type:String,required:!1,default:"sm"},verbose:{type:Boolean,default:!1}}});var v=n(11639),b=n(24455),w=n(69984),k=n.n(w);const x=(0,v.Z)(g,[["render",m]]),M=x;k()(g,"components",{QBtn:b.Z});var C=n(63602);const _={name:"BaseMessage",emits:["reply","mounted"],mixins:[p.Z],props:{event:{type:Object,required:!0},isEmbeded:{type:Boolean,default:!1}},components:{BaseButtonRelays:h.Z,BaseButtonInfo:y.Z,BaseButtonCopy:f.Z,BaseButtonReply:M,BaseMarkdown:C.Z},setup(){const e=(0,c.Z)();e.platform.has.touch},data(){return{invisible:!0,menu:{},render:1,contextMenus:[],persistentMenu:!1,taggedEvents:{}}},computed:{sequence(){let e=[this.event].concat(this.event.appended).filter((e=>e));return this.render,e},sent(){return this.event.pubkey===this.$store.state.keys.pub}},mounted(){setTimeout((()=>{this.invisible=!1}),20);for(let t of this.sequence){var e;let n=(null===(e=t.tags)||void 0===e?void 0:e.filter((([e,t])=>"e"===e&&t)).map((([e,t])=>t)))||[];n.length&&(this.taggedEvents[t.id]=[],this.processTaggedEvents(n,this.taggedEvents[t.id]))}this.event.created_at<this.$store.state.lastMessageRead[this.$route.params.pubkey]&&this.$emit("mounted")},methods:{reply(e){this.$emit("reply",e)},hideMenu(){this.contextMenus=this.contextMenus.map((e=>!1)),this.togglePersistentMenu(!1)},togglePersistentMenu(e){this.persistentMenu=e}}};var q=n(56362),S=n(13246),T=n(62146);const B=(0,v.Z)(_,[["render",u]]),R=B;k()(_,"components",{QMenu:q.Z,QList:S.Z}),k()(_,"directives",{ClosePopup:T.Z})},52787:(e,t,n)=>{"use strict";n.d(t,{Z:()=>D});var s=n(59835),o=n(86970);const i=e=>((0,s.dD)("data-v-7e448bb5"),e=e(),(0,s.Cn)(),e),a=i((()=>(0,s._)("span",{class:"text-bold",style:{"font-size":"1.1rem"}},"relays",-1))),r=(0,s.Uk)("  ( "),l={class:"text-secondary"},d=(0,s.Uk)(" seen "),u=(0,s.Uk)(" not seen "),c=(0,s.Uk)(" ) "),p={style:{"overflow-x":"scroll"}},h={class:"relay-list"},y=(0,s.Uk)("        "),f={key:0,class:"text-secondary",style:{overflow:"hidden"}},m=(0,s.Uk)("\n          "),g=(0,s.Uk)("\n            "),v=(0,s.Uk)("\n        "),b=(0,s.Uk)("\n        "),w={key:1,style:{overflow:"hidden"}},k=(0,s.Uk)("\n          "),x=(0,s.Uk)("\n            "),M=(0,s.Uk)("\n            "),C=(0,s.Uk)("\n        "),_=(0,s.Uk)("\n      ");function q(e,t,n,i,q,S){var T,B;const R=(0,s.up)("q-icon"),Z=(0,s.up)("q-btn");return(0,s.wg)(),(0,s.iD)("div",null,[(0,s._)("div",null,[a,r,(0,s._)("span",l,[(0,s.Wm)(R,{name:"visibility",size:"xs",dense:""}),d]),(0,s._)("span",null,[(0,s.Wm)(R,{name:"visibility_off",size:"xs",dense:""}),u]),c]),(0,s._)("div",p,[(0,s._)("pre",h,[y,null!==(T=n.event)&&void 0!==T&&null!==(B=T.seen_on)&&void 0!==B&&B.length?((0,s.wg)(),(0,s.iD)("div",f,[m,((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(n.event.seen_on,(e=>((0,s.wg)(),(0,s.iD)("div",{key:e,class:"relay-item hide-scrollbar"},[g,(0,s.Wm)(R,{name:"visibility",size:"xs"}),(0,s.Uk)("\n            "+(0,o.zw)(e)+"\n          ",1)])))),128)),v])):(0,s.kq)("",!0),b,S.missingFrom.length?((0,s.wg)(),(0,s.iD)("div",w,[k,((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(S.missingFrom,(e=>((0,s.wg)(),(0,s.iD)("div",{key:e,class:"relay-item unseen-relay-item hide-scrollbar",clickable:""},[x,(0,s.Wm)(Z,{icon:"visibility",flat:"",unelevated:"",color:"secondary",size:"sm",class:"no-padding",dense:"",onClick:t=>S.publishTo(e)},null,8,["onClick"]),M,(0,s.Wm)(R,{name:"visibility_off",size:"xs",clickable:""}),(0,s.Uk)("\n            "+(0,o.zw)(e)+"\n          ",1)])))),128)),C])):(0,s.kq)("",!0),_])])])}n(40702);var S=n(34136),T=n(18933);const B={name:"BaseRelayList",mixins:[T.Z],props:{event:{type:Object,required:!0}},computed:{missingFrom(){return this.event&&this.event.seen_on?Object.entries(this.$store.state.relays).filter((([e,t])=>t.write)).map((([e,t])=>e)).filter((e=>-1===this.event.seen_on.indexOf(e))):[]}},methods:{publishTo(e){(0,S.nY)(this.event,e)}}};var R=n(11639),Z=n(22857),E=n(24455),$=n(69984),P=n.n($);const j=(0,R.Z)(B,[["render",q],["__scopeId","data-v-7e448bb5"]]),D=j;P()(B,"components",{QIcon:Z.Z,QBtn:E.Z})},37139:(e,t,n)=>{"use strict";n.d(t,{Z:()=>M});var s=n(59835);const o={class:"flex column q-gutter-md"},i={key:0};function a(e,t,n,a,r,l){const d=(0,s.up)("BaseRelayCard");return(0,s.wg)(),(0,s.iD)("div",o,[n.listView?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",i,"added relay:")),(0,s.Wm)(d,{url:n.url},null,8,["url"])])}var r=n(18933),l=n(61957),d=n(86970);const u={class:"w-full ml-2"},c={class:"text-bold"};function p(e,t,n,o,i,a){const r=(0,s.up)("q-btn"),p=(0,s.up)("q-card");return(0,s.wg)(),(0,s.iD)("div",u,[(0,s.Wm)(p,{class:"cursor-pointer flex row justify-start items-center",flat:""},{default:(0,s.w5)((()=>[(0,s.Wm)(r,{rounded:"",flat:"",color:"primary",size:"md",icon:n.url in e.$store.state.relays?"check":"add",label:n.url in e.$store.state.relays?"added":"add relay",disable:n.url in e.$store.state.relays,onClick:(0,l.iM)(a.addRelay,["stop"])},null,8,["icon","label","disable","onClick"]),(0,s._)("div",c,(0,d.zw)(n.url),1)])),_:1})])}const h={name:"BaseRelayCard",mixins:[r.Z],props:{url:{type:String,required:!0}},methods:{addRelay(){this.$q.dialog({title:"Add relay?",message:`Add ${this.url} to your list of relays?`,cancel:!0}).onOk((()=>{this.$store.commit("addRelay",this.url)}))}}};var y=n(11639),f=n(44458),m=n(24455),g=n(69984),v=n.n(g);const b=(0,y.Z)(h,[["render",p],["__scopeId","data-v-1b914214"]]),w=b;v()(h,"components",{QCard:f.Z,QBtn:m.Z});const k={name:"BaseRelayRecommend",mixins:[r.Z],components:{BaseRelayCard:w},props:{url:{type:String,required:!0},listView:{type:Boolean,default:!1}}},x=(0,y.Z)(k,[["render",a]]),M=x},36345:(e,t,n)=>{"use strict";n.d(t,{Z:()=>j});var s=n(59835),o=n(86970),i=n(61957);const a={class:"text-secondary pubkey",style:{opacity:".9","font-size":"95%","font-weight":"300"}};function r(e,t,n,r,l,d){const u=(0,s.up)("BaseUserAvatar"),c=(0,s.up)("BaseUserName"),p=(0,s.up)("BaseMarkdown"),h=(0,s.up)("BaseUserCardActions"),y=(0,s.up)("q-item-section"),f=(0,s.up)("q-item");return(0,s.wg)(),(0,s.j4)(f,{clickable:e.clickable,unelevated:"",outlined:"",class:(0,o.C_)(["no-padding flex row justify-start items-center cursor-pointer",(e.alignRight?"text-right reverse":"text-left")+(e.headerMode?" header-mode":"")+(e.hasTouch||e.headerMode||!e.actionButtons?"":" hidden-action-buttons")]),onClick:t[0]||(t[0]=(0,i.iM)((t=>e.toProfile(e.pubkey)),["stop"])),style:{"max-width":"100%",gap:".5rem"}},{default:(0,s.w5)((()=>[(0,s._)("div",null,[(0,s.Wm)(u,{pubkey:e.pubkey,"align-right":e.alignRight,size:e.headerMode?"10rem":"lg",class:(0,o.C_)(e.headerMode?"self-center":"")},null,8,["pubkey","align-right","size","class"])]),(0,s.Wm)(y,{class:(0,o.C_)(e.headerMode?"self-start":""),style:(0,o.j5)(e.headerMode?"":"white-space: nowrap; overflow: auto;")},{default:(0,s.w5)((()=>[(0,s.Wm)(c,{pubkey:e.pubkey,"header-mode":e.headerMode,"show-verified":!0,class:(0,o.C_)(e.headerMode?" text-h6":""),"align-right":e.alignRight,"show-following":e.showFollowing,wrap:e.wrap},null,8,["pubkey","header-mode","class","align-right","show-following","wrap"]),(0,s._)("div",a,(0,o.zw)(e.shorten(e.pubkey)),1),e.headerMode?((0,s.wg)(),(0,s.j4)(p,{key:0},{default:(0,s.w5)((()=>[(0,s.Uk)((0,o.zw)(e.$store.getters.profileDescription(e.pubkey)),1)])),_:1})):(0,s.kq)("",!0),e.actionButtons?((0,s.wg)(),(0,s.j4)(h,{key:1,pubkey:e.pubkey,class:"action-buttons"},null,8,["pubkey"])):(0,s.kq)("",!0)])),_:1},8,["class","style"])])),_:1},8,["clickable","class"])}var l=n(19302),d=n(18933);n(40702);function u(e,t,n,a,r,l){const d=(0,s.up)("BaseButtonCopy"),u=(0,s.up)("BaseButtonMessage"),c=(0,s.up)("BaseButtonFollow");return(0,s.wg)(),(0,s.iD)("div",{class:(0,o.C_)(["flex row no-wrap",e.buttonGroupClass]),style:{gap:".3rem"}},[(0,s.Wm)(d,{"button-text":e.pubkey,"button-size":"sm","text-color":"secondary","tooltip-text":"copy pubkey",onClick:t[0]||(t[0]=(0,i.iM)((()=>{}),["stop"]))},null,8,["button-text"]),e.pubkey!==e.$store.state.keys.pub&&e.$store.state.keys.pub?((0,s.wg)(),(0,s.j4)(u,{key:0,"button-to":"/messages/"+e.pubkey,"button-size":"sm","text-color":"primary",onClick:t[1]||(t[1]=(0,i.iM)((()=>{}),["stop"]))},null,8,["button-to"])):(0,s.kq)("",!0),e.pubkey!==e.$store.state.keys.pub&&e.$store.state.keys.pub?((0,s.wg)(),(0,s.j4)(c,{key:1,pubkey:e.pubkey,"button-size":"sm",onClick:t[2]||(t[2]=(0,i.iM)((()=>{}),["stop"]))},null,8,["pubkey"])):(0,s.kq)("",!0)],2)}const c=(0,s.Uk)(" encrypted message ");function p(e,t,n,a,r,l){const d=(0,s.up)("q-tooltip"),u=(0,s.up)("q-btn");return(0,s.wg)(),(0,s.j4)(u,{icon:"mail_lock",unelevated:"",clickable:"",class:(0,o.C_)([e.buttonClass,"button-message"]),size:e.buttonSize,to:e.buttonTo,onClick:t[0]||(t[0]=(0,i.iM)((()=>{}),["stop"])),dense:""},{default:(0,s.w5)((()=>[(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[c])),_:1})])),_:1},8,["class","size","to"])}const h=(0,s.aZ)({name:"BaseButtonMessage",props:{buttonTo:{type:String,required:!0},buttonClass:{type:String,required:!1,default:""},buttonSize:{type:String,required:!1,default:"sm"}},methods:{copy(){console.log(this.buttonText),navigator.clipboard.writeText(this.buttonText)}}});var y=n(11639),f=n(24455),m=n(46858),g=n(69984),v=n.n(g);const b=(0,y.Z)(h,[["render",p]]),w=b;function k(e,t,n,a,r,l){const d=(0,s.up)("q-icon"),u=(0,s.up)("q-tooltip"),c=(0,s.up)("q-btn");return(0,s.wg)(),(0,s.j4)(c,{class:(0,o.C_)(e.buttonClass+(e.isFollowing?"button-unfollow":"button-follow")),size:e.buttonSize,disable:!e.$store.getters.canSignEventsAutomatically,unelevated:"","text-color":e.isFollowing?"":"secondary",dense:"",onClick:(0,i.iM)(e.toggleFollowing,["stop"])},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{name:e.isFollowing?"person_remove":"person_add",class:(0,o.C_)(e.isFollowing?"flip-horizontal":"")},null,8,["name","class"]),(0,s.Wm)(u,null,{default:(0,s.w5)((()=>[(0,s.Uk)((0,o.zw)(e.isFollowing?"unfollow":"follow"),1)])),_:1})])),_:1},8,["class","size","disable","text-color","onClick"])}v()(h,"components",{QBtn:f.Z,QTooltip:m.Z});n(46727);const x=(0,s.aZ)({name:"BaseButtonFollow",props:{pubkey:{type:String,required:!0},buttonClass:{type:String,required:!1,default:""},buttonSize:{type:String,required:!1,default:"sm"}},computed:{isFollowing(){return this.$store.state.following.includes(this.pubkey)}},methods:{toggleFollowing(){this.isFollowing?this.unfollow():this.follow()},unfollow(){this.$store.commit("unfollow",this.pubkey)},follow(){this.$store.commit("follow",this.pubkey)}}});var M=n(22857);const C=(0,y.Z)(x,[["render",k],["__scopeId","data-v-7672e5ae"]]),_=C;v()(x,"components",{QBtn:f.Z,QIcon:M.Z,QTooltip:m.Z});var q=n(68067);const S=(0,s.aZ)({name:"BaseUserCardActions",props:{pubkey:{type:String,required:!0},buttonGroupClass:{type:String,required:!1,default:""}},components:{BaseButtonMessage:w,BaseButtonFollow:_,BaseButtonCopy:q.Z}}),T=(0,y.Z)(S,[["render",u]]),B=T;var R=n(63602);const Z=(0,s.aZ)({name:"BaseUserCard",components:{BaseUserCardActions:B,BaseMarkdown:R.Z},mixins:[d.Z],props:{pubkey:{type:String,required:!0},alignRight:{type:Boolean,required:!1,default:!1},clickable:{type:Boolean,required:!1,default:!0},headerMode:{type:Boolean,required:!1,default:!1},actionButtons:{type:Boolean,required:!1,default:!0},showFollowing:{type:Boolean,default:!1},wrap:{type:Boolean,default:!1}},setup(){const e=(0,l.Z)();let t=(null===e||void 0===e?void 0:e.platform.has.touch)||!1;return{hasTouch:t}}});var E=n(490),$=n(76749);const P=(0,y.Z)(Z,[["render",r],["__scopeId","data-v-3a7b4b39"]]),j=P;v()(Z,"components",{QItem:E.Z,QItemSection:$.Z})},69159:()=>{}},t={};function n(s){var o=t[s];if(void 0!==o)return o.exports;var i=t[s]={id:s,loaded:!1,exports:{}};return e[s].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}n.m=e,(()=>{var e=[];n.O=(t,s,o,i)=>{if(!s){var a=1/0;for(u=0;u<e.length;u++){for(var[s,o,i]=e[u],r=!0,l=0;l<s.length;l++)(!1&i||a>=i)&&Object.keys(n.O).every((e=>n.O[e](s[l])))?s.splice(l--,1):(r=!1,i<a&&(a=i));if(r){e.splice(u--,1);var d=o();void 0!==d&&(t=d)}}return t}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[s,o,i]}})(),(()=>{n.n=e=>{var t=e&&e.__esModule?()=>e["default"]:()=>e;return n.d(t,{a:t}),t}})(),(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(s,o){if(1&o&&(s=this(s)),8&o)return s;if("object"===typeof s&&s){if(4&o&&s.__esModule)return s;if(16&o&&"function"===typeof s.then)return s}var i=Object.create(null);n.r(i);var a={};e=e||[null,t({}),t([]),t(t)];for(var r=2&o&&s;"object"==typeof r&&!~e.indexOf(r);r=t(r))Object.getOwnPropertyNames(r).forEach((e=>a[e]=()=>s[e]));return a["default"]=()=>s,n.d(i,a),i}})(),(()=>{n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}})(),(()=>{n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,s)=>(n.f[s](e,t),t)),[]))})(),(()=>{n.u=e=>"js/"+e+"."+{6:"8db95b3f",183:"ab25fb78",196:"b8f6b213",198:"bf912cd4",316:"4a671547",355:"e1b4dab2",369:"8071b9d4",426:"7b056dd8",433:"f17a191f",437:"e3ab1570",584:"9f2bb3c4",636:"243b393c",702:"d94efb7d",722:"a069b7d3"}[e]+".js"})(),(()=>{n.miniCssF=e=>"css/"+({143:"app",736:"vendor"}[e]||e)+"."+{6:"08def4aa",143:"6dc2b8ac",183:"f5c9dbbb",196:"737e4cc8",198:"4f2502bf",369:"a17e1673",584:"d88ae4a7",702:"5ee21452",722:"31d6cfe0",736:"af6b9db3"}[e]+".css"})(),(()=>{n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{var e={},t="astral:";n.l=(s,o,i,a)=>{if(e[s])e[s].push(o);else{var r,l;if(void 0!==i)for(var d=document.getElementsByTagName("script"),u=0;u<d.length;u++){var c=d[u];if(c.getAttribute("src")==s||c.getAttribute("data-webpack")==t+i){r=c;break}}r||(l=!0,r=document.createElement("script"),r.charset="utf-8",r.timeout=120,n.nc&&r.setAttribute("nonce",n.nc),r.setAttribute("data-webpack",t+i),r.src=s),e[s]=[o];var p=(t,n)=>{r.onerror=r.onload=null,clearTimeout(h);var o=e[s];if(delete e[s],r.parentNode&&r.parentNode.removeChild(r),o&&o.forEach((e=>e(n))),t)return t(n)},h=setTimeout(p.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=p.bind(null,r.onerror),r.onload=p.bind(null,r.onload),l&&document.head.appendChild(r)}}})(),(()=>{n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e)})(),(()=>{n.j=143})(),(()=>{n.p="/"})(),(()=>{var e=(e,t,n,s)=>{var o=document.createElement("link");o.rel="stylesheet",o.type="text/css";var i=i=>{if(o.onerror=o.onload=null,"load"===i.type)n();else{var a=i&&("load"===i.type?"missing":i.type),r=i&&i.target&&i.target.href||t,l=new Error("Loading CSS chunk "+e+" failed.\n("+r+")");l.code="CSS_CHUNK_LOAD_FAILED",l.type=a,l.request=r,o.parentNode.removeChild(o),s(l)}};return o.onerror=o.onload=i,o.href=t,document.head.appendChild(o),o},t=(e,t)=>{for(var n=document.getElementsByTagName("link"),s=0;s<n.length;s++){var o=n[s],i=o.getAttribute("data-href")||o.getAttribute("href");if("stylesheet"===o.rel&&(i===e||i===t))return o}var a=document.getElementsByTagName("style");for(s=0;s<a.length;s++){o=a[s],i=o.getAttribute("data-href");if(i===e||i===t)return o}},s=s=>new Promise(((o,i)=>{var a=n.miniCssF(s),r=n.p+a;if(t(a,r))return o();e(s,r,o,i)})),o={143:0,176:0};n.f.miniCss=(e,t)=>{var n={6:1,183:1,196:1,198:1,369:1,584:1,702:1,722:1};o[e]?t.push(o[e]):0!==o[e]&&n[e]&&t.push(o[e]=s(e).then((()=>{o[e]=0}),(t=>{throw delete o[e],t})))}})(),(()=>{n.b=document.baseURI||self.location.href;var e={143:0,176:0};n.f.j=(t,s)=>{var o=n.o(e,t)?e[t]:void 0;if(0!==o)if(o)s.push(o[2]);else{var i=new Promise(((n,s)=>o=e[t]=[n,s]));s.push(o[2]=i);var a=n.p+n.u(t),r=new Error,l=s=>{if(n.o(e,t)&&(o=e[t],0!==o&&(e[t]=void 0),o)){var i=s&&("load"===s.type?"missing":s.type),a=s&&s.target&&s.target.src;r.message="Loading chunk "+t+" failed.\n("+i+": "+a+")",r.name="ChunkLoadError",r.type=i,r.request=a,o[1](r)}};n.l(a,l,"chunk-"+t,t)}},n.O.j=t=>0===e[t];var t=(t,s)=>{var o,i,[a,r,l]=s,d=0;if(a.some((t=>0!==e[t]))){for(o in r)n.o(r,o)&&(n.m[o]=r[o]);if(l)var u=l(n)}for(t&&t(s);d<a.length;d++)i=a[d],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return n.O(u)},s=globalThis["webpackChunkastral"]=globalThis["webpackChunkastral"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var s=n.O(void 0,[736,64],(()=>n(94188)));s=n.O(s)})();