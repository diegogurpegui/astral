"use strict";(globalThis["webpackChunkastral"]=globalThis["webpackChunkastral"]||[]).push([[433],{15433:(t,i,s)=>{s.r(i),s.d(i,{default:()=>b});var e=s(59835),a=s(86970);const o={key:0,class:"row justify-center q-my-md"};function n(t,i,s,n,c,h){const r=(0,e.up)("BaseHeader"),d=(0,e.up)("BasePost"),l=(0,e.up)("q-spinner-orbit"),f=(0,e.up)("q-infinite-scroll"),u=(0,e.up)("q-page");return(0,e.wg)(),(0,e.j4)(u,null,{default:(0,e.w5)((()=>[(0,e.Wm)(r,null,{default:(0,e.w5)((()=>[(0,e.Uk)((0,a.zw)(t.$t("notifications")),1)])),_:1}),(0,e.Wm)(f,{disable:c.reachedEnd,onLoad:h.loadMore,offset:150},{loading:(0,e.w5)((()=>[c.reachedEnd?(0,e.kq)("",!0):((0,e.wg)(),(0,e.iD)("div",o,[(0,e.Wm)(l,{color:"accent",size:"md"})]))])),default:(0,e.w5)((()=>[((0,e.wg)(!0),(0,e.iD)(e.HY,null,(0,e.Ko)(c.notifications,(i=>((0,e.wg)(),(0,e.iD)("div",{key:i.id},[(0,e.Wm)(d,{event:i,highlighted:t.$store.state.lastNotificationRead<i.created_at},null,8,["event","highlighted"])])))),128))])),_:1},8,["disable","onLoad"])])),_:1})}s(40702);var c=s(18933),h=s(34136);const r={name:"Notifications",mixins:[c.Z],data(){return{notifications:[],notificationsSet:new Set,reachedEnd:!1,sub:null,reading:!1,profilesUsed:new Set}},async activated(){this.$store.state.unreadNotifications&&this.loadNew(),this.sub=(0,h.JL)(this.$store.state.keys.pub,(async t=>{let i=await this.processNotifications([t]);0!==i.length&&(this.notifications=i.concat(this.notifications),this.highlightUnreadNotifications())}))},async deactivated(){this.$store.commit("haveReadNotifications"),this.sub&&this.sub.cancel(),this.profilesUsed.forEach((t=>this.$store.dispatch("cancelUseProfile",{pubkey:t})))},methods:{async loadMore(t,i){let s;s=this.notifications.length?this.notifications[this.notifications.length-1].created_at-1:Math.round(Date.now()/1e3);let e=await(0,h.t_)(this.$store.state.keys.pub,40,s);e.length<40&&(this.reachedEnd=!0);let a=await this.processNotifications(e);this.notifications=this.notifications.concat(a),this.highlightUnreadNotifications(),i(this.reachedEnd)},async loadNew(){let t=await(0,h.t_)(this.$store.state.keys.pub,40),i=await this.processNotifications(t);this.notifications=i.concat(this.notifications),this.highlightUnreadNotifications()},processNotifications(t){let i=[];for(let s=0;s<t.length;s++){let e=t[s];this.notificationsSet.has(e.id)||(this.notificationsSet.add(e.id),this.interpolateEventMentions(e),i.push(e),this.useProfile(e.pubkey))}return i},highlightUnreadNotifications(){this.notifications.length>0&&this.notifications[0].created_at>this.$store.state.lastNotificationRead&&setTimeout((()=>{this.$store.commit("haveReadNotifications")}),3e3*this.notifications.filter((t=>t.created_at>this.$store.state.lastNotificationRead)).length)},addNotificationEvent(t){if(0===this.notifications.length)return void this.notifications.push(t);if(this.notifications[this.notifications.length-1].created_at>=t.created_at)return void this.notifications.push(t);if(this.notifications[0].created_at<=t.created_at)return void this.notifications.unshift(t);let i=this.notifications.findIndex(((i,s,e)=>i.created_at<=t.created_at&&(0===s||e[s-1].created_at>=t.created_at)));i>=0?this.notifications.splice(i,0,t):this.notifications.push(t)},useProfile(t){this.profilesUsed.has(t)||(this.profilesUsed.add(t),this.$store.dispatch("useProfile",{pubkey:t}))}}};var d=s(11639),l=s(69885),f=s(86870),u=s(10786),p=s(69984),g=s.n(p);const w=(0,d.Z)(r,[["render",n]]),b=w;g()(r,"components",{QPage:l.Z,QInfiniteScroll:f.Z,QSpinnerOrbit:u.Z})}}]);