(()=>{"use strict";var e={35176:(e,r,t)=>{t(40702);var s=t(68048),n=t(67694);const o=(0,n.UA)();let a=null;o.onNotice(((e,r)=>{try{f.postMessage({type:"notice",notice:e,relay:r.url})}catch(t){console.log("error posting message to db from pool",t,"notice",e,"url ",r.url)}}));let u={},l={},i=!0,c=0,f=null,d=0,p=(0,s.Z)((e=>f.postMessage({type:"events",events:e})),1e3,{concatArrays:!0,promise:!0,maxWait:3e3});function y(e,r){i&&(d>=2e3&&(p.flush(),d=0),p([{event:e,relay:r}]),d++)}function v(e){}function b(){let e=Object.entries(l).map((([e,r])=>r)).reduce(((e,{type:r,value:t})=>{if("user"===r)return e[r]=[t],e;if("feed"===r)return(!e[r]||e[r]>=t)&&(e[r]=t),e;if("tag"===r){let r=t.tagType,s=t.tagValues;return e[`#${r}`]=(e[`#${r}`]||[]).concat(s),e}return e[r]=(e[r]||[]).concat(t),e}),{}),r=Object.entries(e).map((([e,r])=>{switch(e){case"user":return{authors:r,kinds:[0,1,2,3,4],since:c};case"userNotes":return{authors:r,kinds:[1]};case"userProfile":return{authors:r,kinds:[0]};case"userFollows":return{authors:r,kinds:[3]};case"userFollowers":return{"#p":r,kinds:[3]};case"userTags":return{"#p":r,kinds:[1,3,4],since:c};case"userMessages":return{authors:r,kinds:[4]};case"feed":return{since:r,kinds:[1,2]};case"event":return{ids:r};default:return{[e]:r,kinds:[0,1,2,3,4]}}}));return r}function g(e){delete l[e],i&&a&&(0===Object.keys(l).length?a.unsub():a.sub({filter:b()}))}const h={close(){self.close()},activateSub(){i=!0,a&&Object.keys(l).length&&a.sub({filter:b()})},deactivateSub(){i=!1,a&&a.unsub(),p.flush()},subUser(e){return{type:"user",value:e}},subUserNotes(e){return{type:"userNotes",value:e}},subUserProfile(e){return{type:"userProfile",value:e}},subUserFollows(e){return{type:"userFollows",value:e}},subUserFollowers(e){return{type:"userFollowers",value:e}},subUserTags(e){return{type:"userTags",value:e}},subTag(e,r){let t=Array.isArray(r)?r:[r];return{type:"tag",value:{tagType:e,tagValues:t}}},subFeed(e){return{type:"feed",value:e}},subEvent(e){let r=Array.isArray(e)?e:[e];return{type:"event",value:r}},setRelays(e,r){c=r;for(let t in e)u[t]?u[t].read===e[t].read&&u[t].write===e[t].write||(o.removeRelay(t),o.addRelay(t,e[t])):o.addRelay(t,e[t]);for(let t in u)e[t]||o.removeRelay(t),e[t]||console.log("removing relay",t);return u=e,u},publish(e,r){var t,s,n;if(r)return null===(t=o.relays[r])||void 0===t||null===(s=t.relay)||void 0===s||null===(n=s.publish)||void 0===n?void 0:n.call(s,e);o.publish(e,((r,t)=>{0===r&&console.log(`publish request sent to ${t}`),1===r&&console.log(`event published by ${t}`,e)}))}};function m(e){let{name:r,args:t,id:s,cancel:n,sub:u}="string"===typeof e.data?JSON.parse(e.data):e.data;if(e.ports.length&&"setPort"===r)f=e.ports[0];else if(!e.data.type)if(n)g(s);else if(u){if(l[s]=h[r](...t),!i)return;a?a.sub({filter:b()}):a=o.sub({cb:y,filter:b()},"main",v)}else{var c={id:s};let e;try{e=h[r](...t),c.success=!0,c.data=e}catch(d){c.success=!1,c.error=d.message}self.postMessage(JSON.stringify(c))}}self.onmessage=m}},r={};function t(s){var n=r[s];if(void 0!==n)return n.exports;var o=r[s]={id:s,loaded:!1,exports:{}};return e[s].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}t.m=e,t.x=()=>{var e=t.O(void 0,[736,64],(()=>t(35176)));return e=t.O(e),e},(()=>{var e=[];t.O=(r,s,n,o)=>{if(!s){var a=1/0;for(c=0;c<e.length;c++){for(var[s,n,o]=e[c],u=!0,l=0;l<s.length;l++)(!1&o||a>=o)&&Object.keys(t.O).every((e=>t.O[e](s[l])))?s.splice(l--,1):(u=!1,o<a&&(a=o));if(u){e.splice(c--,1);var i=n();void 0!==i&&(r=i)}}return r}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[s,n,o]}})(),(()=>{t.n=e=>{var r=e&&e.__esModule?()=>e["default"]:()=>e;return t.d(r,{a:r}),r}})(),(()=>{var e,r=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;t.t=function(s,n){if(1&n&&(s=this(s)),8&n)return s;if("object"===typeof s&&s){if(4&n&&s.__esModule)return s;if(16&n&&"function"===typeof s.then)return s}var o=Object.create(null);t.r(o);var a={};e=e||[null,r({}),r([]),r(r)];for(var u=2&n&&s;"object"==typeof u&&!~e.indexOf(u);u=r(u))Object.getOwnPropertyNames(u).forEach((e=>a[e]=()=>s[e]));return a["default"]=()=>s,t.d(o,a),o}})(),(()=>{t.d=(e,r)=>{for(var s in r)t.o(r,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:r[s]})}})(),(()=>{t.f={},t.e=e=>Promise.all(Object.keys(t.f).reduce(((r,s)=>(t.f[s](e,r),r)),[]))})(),(()=>{t.u=e=>"js/"+{64:"chunk-common",736:"vendor"}[e]+"."+{64:"2d076079",736:"7252949d"}[e]+".js"})(),(()=>{t.miniCssF=e=>"css/vendor.af6b9db3.css"})(),(()=>{t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{t.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r)})(),(()=>{t.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{t.nmd=e=>(e.paths=[],e.children||(e.children=[]),e)})(),(()=>{t.j=176})(),(()=>{t.p="/"})(),(()=>{var e={176:1},r=r=>{var[s,o,a]=r;for(var u in o)t.o(o,u)&&(t.m[u]=o[u]);a&&a(t);while(s.length)e[s.pop()]=1;n(r)};t.f.i=(r,s)=>{e[r]||importScripts(t.p+t.u(r))};var s=globalThis["webpackChunkastral"]=globalThis["webpackChunkastral"]||[],n=s.push.bind(s);s.push=r})(),(()=>{var e=t.x;t.x=()=>Promise.all([t.e(736),t.e(64)]).then(e)})();t.x()})();